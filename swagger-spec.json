{"openapi":"3.0.0","paths":{"/api/auth/challenge":{"post":{"description":"\n**DID-based Authentication Flow - Step 1**\n\nRequest a challenge message to sign with your wallet. This endpoint also returns VP (Verifiable Presentation) signing data if the user has any Verifiable Credentials.\n\n**CRITICAL: Wallet Address Format**\n- ⚠️ Wallet address MUST be lowercase\n- ❌ WRONG: \"0xE9ebc691cCFB15Cb4bf31Af83c624b7020f0d2C0\"\n- ✅ CORRECT: \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\"\n\n**Flow:**\n1. Send wallet address (lowercase)\n2. Receive challenge string + VP signing data (if VCs exist)\n3. Sign both:\n   - Challenge with wallet.signMessage(challenge)\n   - VP messageHash with wallet.signMessage(messageHash)\n4. Submit signatures to /api/auth/login\n\n**Challenge Expiration:** 5 minutes (300 seconds)\n    ","operationId":"AuthController_getChallenge","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChallengeRequestDto"}}}},"responses":{"200":{"description":"Challenge and VP signing data successfully generated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChallengeResponseDto"}}}},"400":{"description":"Bad Request - Invalid wallet address format"}},"summary":"Step 1: Get Challenge for Wallet Signature","tags":["Authentication"]}},"/api/auth/login":{"post":{"description":"\n**DID-based Authentication Flow - Step 2**\n\nVerify wallet signature and create authenticated session. If user has VCs, also verifies VP signature and creates VP JWT.\n\n**CRITICAL: Wallet Address Format**\n- ⚠️ Wallet address MUST be lowercase\n- Backend normalizes all addresses to lowercase for comparison\n- Mixed-case addresses will result in \"wallet not found\" error\n\n**Request Flow:**\n1. Submit signed challenge from Step 1\n2. Submit VP signature (if you received vpSigningData in Step 1)\n3. Receive access token + refresh token + VP JWT\n4. Store tokens securely (localStorage or httpOnly cookies)\n\n**Authentication:**\n- Access Token: Use in Authorization header for API calls\n- Refresh Token: Use to obtain new access token when expired\n- VP JWT: Verifiable Presentation (EMPTY if no VCs)\n\n**Success Response:**\n- accessToken: JWT for API authentication\n- refreshToken: Token to refresh session\n- vpJwt: Verifiable Presentation JWT\n- profile: User profile including guardian info and VC count\n\n**Next Steps:**\n- Store tokens securely\n- Use accessToken in Authorization: Bearer {token} header\n- Check profile.guardianInfo to determine if guardian registration needed\n    ","operationId":"AuthController_login","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequestDto"}}}},"responses":{"200":{"description":"Login successful - tokens and profile returned","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponseDto"}}}},"401":{"description":"Unauthorized - Invalid signature or challenge expired"}},"summary":"Step 2: Login with Wallet Signature and VP","tags":["Authentication"]}},"/api/auth/profile":{"get":{"description":"\n**Get Authenticated User Profile**\n\nRetrieve complete user profile including:\n- DID and wallet address\n- Guardian registration status and info\n- Verifiable Credentials count (total, pets, identity)\n- List of owned pets with VC data\n\n**Authentication Required:**\n- Include access token in Authorization header\n- Format: \"Authorization: Bearer {accessToken}\"\n\n**Profile Information:**\n- did: Decentralized Identifier\n- walletAddress: Ethereum wallet address\n- isGuardian: Whether user is registered as guardian\n- guardianInfo: Guardian details (null if not registered)\n- credentials: VC statistics breakdown\n- pets: Array of owned pets with VC info\n\n**Use Cases:**\n- Check guardian registration status\n- Display user dashboard\n- Show owned pets list\n- Verify VC ownership\n    ","operationId":"AuthController_getProfile","parameters":[],"responses":{"200":{"description":"Profile successfully retrieved","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileResponseDto"}}}},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Get User Profile","tags":["Authentication"]}},"/api/auth/logout":{"post":{"description":"\n**Logout from Current Device/Session**\n\nRevoke the current access token and associated VP. This only logs out the current session.\n\n**What Happens:**\n- Current access token is blocked and cannot be reused\n- Associated VP JWT is deleted\n- VP verification cache is cleared\n- Other sessions on different devices remain active\n\n**Authentication Required:**\n- Include current access token in Authorization header\n- Format: \"Authorization: Bearer {accessToken}\"\n\n**Use Cases:**\n- User logs out from current device\n- Switch accounts on same device\n- Security: Revoke compromised session\n\n**Note:**\n- To logout from all devices, use POST /api/auth/logout-all\n- Tokens cannot be reused after logout\n- User must login again to get new tokens\n    ","operationId":"AuthController_logout","parameters":[],"responses":{"200":{"description":"Current session logged out successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LogoutResponseDto"}}}},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Logout Current Session","tags":["Authentication"]}},"/api/auth/logout-all":{"post":{"description":"\n**Logout from All Devices/Sessions**\n\nRevoke ALL access tokens and VPs for this wallet address. This logs out all sessions on all devices.\n\n**What Happens:**\n- ALL access tokens for this wallet are blocked\n- ALL associated VPs are deleted\n- User is logged out from all devices (mobile, desktop, tablet, etc.)\n- All active sessions are terminated\n\n**Authentication Required:**\n- Include access token in Authorization header\n- Format: \"Authorization: Bearer {accessToken}\"\n\n**Use Cases:**\n- Security: Suspect account compromise\n- User wants fresh start on all devices\n- Lost device - revoke all sessions remotely\n- Change wallet password/keys\n\n**Important:**\n- This is irreversible - all active sessions will be terminated\n- User must login again on ALL devices\n- Cannot recover previous sessions\n- Use with caution\n\n**Note:**\n- For single device logout, use POST /api/auth/logout\n- Recommended after security incidents\n    ","operationId":"AuthController_logoutAll","parameters":[],"responses":{"200":{"description":"All sessions logged out successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LogoutResponseDto"}}}},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Logout All Sessions","tags":["Authentication"]}},"/vc/prepare-vc-signing":{"post":{"operationId":"VcController_prepareVCSigning","parameters":[],"responses":{"201":{"description":""}},"security":[{"bearer":[]}],"tags":["VC"]}},"/vc/create-vc-with-signature":{"post":{"operationId":"VcController_createVCWithSignature","parameters":[],"responses":{"201":{"description":""}},"security":[{"bearer":[]}],"tags":["VC"]}},"/vc/pet/{petDID}":{"get":{"operationId":"VcController_getVC","parameters":[{"name":"petDID","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"security":[{"bearer":[]}],"tags":["VC"]}},"/vc/health":{"get":{"operationId":"VcController_healthCheck","parameters":[],"responses":{"200":{"description":""}},"security":[{"bearer":[]}],"tags":["VC"]}},"/api/pet":{"get":{"description":"\n**Retrieve all pets owned by the authenticated guardian from Spring backend database**\n\nThis endpoint returns pet profile information stored in the Spring backend, which may differ from blockchain pet registry data.\n\n**Data Source:**\n- Spring backend database (NOT blockchain PetDIDRegistry)\n- Pets are linked to guardians through Spring's member-pet relationship table\n- Pet data includes Spring-specific fields like adoption status, story count, etc.\n\n**Returned Pet Information:**\n- Pet ID (Spring database ID, different from blockchain petId)\n- Pet name, species, breed, age, gender\n- Profile images and descriptions\n- Adoption status (if pet is available for adoption)\n- Relationship to guardian (owner, foster, shelter)\n- Daily story and review counts\n- Registration date in Spring backend\n\n**Use Cases:**\n- Display user's pet list in profile page\n- Select pet for creating adoption posts\n- Select pet for writing daily stories or reviews\n- Show pet dashboard with stats\n\n**Integration with Other Endpoints:**\n- Use returned petId for POST /api/adoption/post\n- Use returned petId for POST /api/story/daily or POST /api/story/review\n- Use returned petId for POST /api/donation/posts\n\n**Blockchain vs Spring Backend:**\n```\nBlockchain PetDIDRegistry:\n- Pet DID (did:ethr:besu:0x...)\n- Biometric hash (nose print)\n- Owner (guardian wallet address)\n- On-chain ownership history\n\nSpring Backend (this endpoint):\n- Pet ID (numeric database ID)\n- Extended pet profile (photos, description, personality)\n- Adoption posts, stories, donations\n- Social features (likes, comments)\n```\n\n**Authentication:**\n- Requires valid JWT access token\n- Returns only pets owned by the authenticated user\n\n**Example Response:**\n```json\n{\n  \"result\": [\n    {\n      \"petId\": 12345,\n      \"name\": \"바둑이\",\n      \"species\": \"DOG\",\n      \"breed\": \"Golden Retriever\",\n      \"age\": 3,\n      \"gender\": \"M\",\n      \"profileImage\": \"https://kr.object.ncloudstorage.com/.../profile.jpg\",\n      \"adoptionStatus\": \"NOT_FOR_ADOPTION\",\n      \"storyCount\": 25,\n      \"reviewCount\": 1,\n      \"registeredAt\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n    ","operationId":"SpringController_getMyPets","parameters":[],"responses":{"200":{"description":"Pet list retrieved successfully"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Get My Pet List","tags":["Spring Backend Proxy"]}},"/api/adoption":{"get":{"description":"\n**Retrieve adoption posts with filtering and cursor-based pagination**\n\nThis endpoint returns a list of adoption posts from the Spring backend. Posts can be filtered by status, breed, and location.\n\n**Pagination:**\n- Uses cursor-based pagination for efficient scrolling\n- `cursor`: The ID of the last item from the previous page (for next page)\n- `size`: Number of items per page (default: 10, max: 100)\n- Returns `nextCursor` in response for fetching the next page\n\n**Filtering Options:**\n- `status`: \"OPEN\" (accepting applications), \"PENDING\" (under review), \"CLOSED\" (completed/cancelled)\n- `breed`: Pet breed (e.g., \"Golden Retriever\", \"시바견\", \"페르시안\")\n- `region`: Province/Region (e.g., \"서울\", \"경기\", \"부산\")\n- `district`: City/District (e.g., \"강남구\", \"수원시\")\n\n**Complete Flow:**\n```javascript\n// 1. Initial load - get first page\nconst response1 = await fetch('/api/adoption?size=10');\n// { posts: [...10 posts...], nextCursor: 45678 }\n\n// 2. Load next page using cursor\nconst response2 = await fetch('/api/adoption?cursor=45678&size=10');\n// { posts: [...10 more posts...], nextCursor: 45668 }\n\n// 3. With filters\nconst filtered = await fetch('/api/adoption?status=OPEN&breed=Golden Retriever&region=서울&size=20');\n```\n\n**Use Cases:**\n- Display adoption post feed on home screen\n- Browse available pets for adoption\n- Filter posts by location and pet characteristics\n- Infinite scroll implementation\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"posts\": [\n      {\n        \"adoptId\": 123,\n        \"petId\": 12345,\n        \"petName\": \"바둑이\",\n        \"title\": \"사랑스러운 골든 리트리버 입양하세요!\",\n        \"breed\": \"Golden Retriever\",\n        \"age\": 3,\n        \"region\": \"서울\",\n        \"district\": \"강남구\",\n        \"status\": \"OPEN\",\n        \"images\": [\"pet-photo-1.jpg\", \"pet-photo-2.jpg\"],\n        \"createdAt\": \"2025-10-20T10:00:00Z\"\n      }\n    ],\n    \"nextCursor\": 122,\n    \"hasMore\": true\n  }\n}\n```\n\n**No Authentication Required:**\n- Public endpoint - anyone can browse adoption posts\n- Authentication only required for creating posts or chatting\n    ","operationId":"SpringController_getAdoptions","parameters":[{"name":"cursor","required":false,"in":"query","description":"Cursor for pagination (ID of last item from previous page)","schema":{"type":"number"}},{"name":"size","required":false,"in":"query","description":"Number of items per page (default: 10, max: 100)","schema":{"type":"number"}},{"name":"status","required":false,"in":"query","description":"Filter by adoption status: OPEN, PENDING, CLOSED","schema":{"enum":["OPEN","PENDING","CLOSED"],"type":"string"}},{"name":"breed","required":false,"in":"query","description":"Filter by pet breed (e.g., \"Golden Retriever\", \"시바견\")","schema":{"type":"string"}},{"name":"region","required":false,"in":"query","description":"Filter by region/province (e.g., \"서울\", \"경기\")","schema":{"type":"string"}},{"name":"district","required":false,"in":"query","description":"Filter by district/city (e.g., \"강남구\", \"수원시\")","schema":{"type":"string"}}],"responses":{"200":{"description":"Adoption posts retrieved successfully"}},"summary":"Get Adoption Posts (Cursor-based Pagination)","tags":["Spring Backend Proxy"]}},"/api/adoption/detail/{adoptId}":{"get":{"description":"\n**Retrieve detailed information about a specific adoption post**\n\nThis endpoint returns complete adoption post details including pet information, guardian contact, and post content.\n\n**Returned Information:**\n- Complete adoption post data (title, content, images, deadline)\n- Pet information (name, breed, age, gender, health status)\n- Guardian information (name, wallet address, contact)\n- Location details (region, district)\n- Shelter information (if applicable)\n- Post status and creation date\n- View count and interaction statistics\n\n**Use Cases:**\n- Display adoption post detail page\n- Show complete pet information to potential adopters\n- Provide contact information for adoption inquiries\n- Get adoption post data before creating chat room\n\n**Flow to Adoption:**\n```\n1. User browses adoption list (GET /api/adoption)\n2. User clicks on post → GET /api/adoption/detail/:adoptId\n3. User decides to inquire → POST /api/chat/room/create\n4. Communication via WebSocket chat\n5. If adoption succeeds → POST /api/adoption/:adoptionId/complete\n6. Ownership transfer on blockchain → POST /pet/accept-transfer/:petDID\n```\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"adoptId\": 123,\n    \"petId\": 12345,\n    \"petName\": \"바둑이\",\n    \"species\": \"DOG\",\n    \"breed\": \"Golden Retriever\",\n    \"age\": 3,\n    \"gender\": \"M\",\n    \"title\": \"사랑스러운 골든 리트리버 입양하세요!\",\n    \"content\": \"건강하고 활발한 골든 리트리버입니다...\",\n    \"images\": [\"photo1.jpg\", \"photo2.jpg\"],\n    \"region\": \"서울\",\n    \"district\": \"강남구\",\n    \"shelterName\": \"서울 유기견 보호소\",\n    \"contact\": \"010-1234-5678\",\n    \"deadline\": \"2025-12-31\",\n    \"status\": \"OPEN\",\n    \"guardianAddress\": \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\",\n    \"guardianName\": \"홍길동\",\n    \"viewCount\": 150,\n    \"createdAt\": \"2025-10-20T10:00:00Z\"\n  }\n}\n```\n\n**No Authentication Required:**\n- Public endpoint - anyone can view adoption post details\n    ","operationId":"SpringController_getAdoptionDetail","parameters":[{"name":"adoptId","required":true,"in":"path","description":"Adoption post ID to retrieve details for","schema":{"type":"number"}}],"responses":{"200":{"description":"Adoption post details retrieved successfully"},"404":{"description":"Not Found - Adoption post does not exist"}},"summary":"Get Adoption Post Detail","tags":["Spring Backend Proxy"]}},"/api/adoption/home":{"get":{"description":"\n**Retrieve curated content for the application home screen**\n\nThis endpoint returns a collection of featured content including recent adoption posts, popular stories, and trending donations.\n\n**Returned Content Sections:**\n- Featured adoption posts (最新 입양 공고)\n- Recent daily stories (最신 일상 스토리)\n- Latest adoption reviews (最신 입양 후기)\n- Active donation campaigns (진행 중인 후원)\n- Recommended pets for adoption\n- Popular posts by interaction count\n\n**Use Cases:**\n- Display home screen feed\n- Show curated content to new users\n- Provide overview of platform activity\n- Highlight urgent adoption cases\n\n**Content Curation:**\n- Posts are sorted by recency, popularity, or urgency\n- May include algorithm-based recommendations\n- Featured content is updated regularly\n- Mix of different content types for engagement\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"featuredAdoptions\": [\n      { \"adoptId\": 123, \"petName\": \"바둑이\", \"title\": \"...\", \"images\": [...] }\n    ],\n    \"recentStories\": [\n      { \"storyId\": 456, \"title\": \"오늘의 산책\", \"author\": \"...\", \"likes\": 45 }\n    ],\n    \"reviewStories\": [\n      { \"reviewId\": 789, \"title\": \"행복한 입양 후기\", \"petName\": \"...\" }\n    ],\n    \"activeDonations\": [\n      { \"donationId\": 321, \"title\": \"긴급 수술비 후원\", \"progress\": 65 }\n    ]\n  }\n}\n```\n\n**No Authentication Required:**\n- Public endpoint - anyone can access home screen data\n    ","operationId":"SpringController_getAdoptionHome","parameters":[],"responses":{"200":{"description":"Home screen data retrieved successfully"}},"summary":"Get Home Screen Data","tags":["Spring Backend Proxy"]}},"/api/adoption/post":{"post":{"description":"\n**Create a new adoption post for a pet you own**\n\nThis endpoint allows guardians to create adoption posts to find new homes for their pets.\n\n**Prerequisites:**\n1. Guardian must be registered (POST /api/guardian/register)\n2. Pet must be registered in Spring backend (GET /api/pet to see your pets)\n3. Pet must be owned by the authenticated guardian\n4. Images must be uploaded to S3 first (POST /common)\n\n**Complete Adoption Post Creation Flow:**\n```javascript\n// 1. Upload pet images to S3\nconst imageResponse1 = await fetch('/common', { method: 'POST' });\nconst { url: uploadUrl1, filename: filename1 } = await imageResponse1.json();\nawait fetch(uploadUrl1, { method: 'PUT', body: imageFile1 });\n\n// 2. Repeat for more images\n// ...\n\n// 3. Create adoption post\nconst adoptionResponse = await fetch('/api/adoption/post', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    petId: 12345,  // From GET /api/pet\n    title: '사랑스러운 골든 리트리버 입양하세요!',\n    images: 'filename1.jpg,filename2.jpg,filename3.jpg',\n    content: '건강하고 활발한 골든 리트리버입니다...',\n    region: '서울',\n    district: '강남구',\n    shelterName: '서울 유기견 보호소',  // Required for ADMIN role\n    contact: '010-1234-5678',\n    deadline: '2025-12-31',\n    status: 'OPEN'\n  })\n});\n```\n\n**Field Requirements:**\n- `petId`: Required, must be your pet from GET /api/pet\n- `title`: Required, 5-100 characters\n- `images`: Required, comma-separated S3 filenames\n- `content`: Required, detailed description\n- `region`, `district`: Optional but recommended for local adoption\n- `shelterName`: Required for ADMIN role guardians\n- `contact`: Optional contact information\n- `deadline`: Optional adoption deadline\n- `status`: Optional, defaults to \"OPEN\"\n\n**Role-based Differences:**\n- **USER role**: Individual pet owners, shelterName optional\n- **ADMIN role**: Shelters/organizations, shelterName required\n\n**After Creating Post:**\n- Post appears in GET /api/adoption listing\n- Potential adopters can contact you via POST /api/chat/room/create\n- When adoption succeeds, call POST /api/adoption/:adoptionId/complete\n\n**Authentication:**\n- Requires valid JWT access token\n- User must own the pet specified in petId\n    ","operationId":"SpringController_createAdoptionPost","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateAdoptionPostDto"}}}},"responses":{"201":{"description":"Adoption post created successfully"},"400":{"description":"Bad Request - Invalid pet ID, missing required fields, or pet not owned by user"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Create Adoption Post","tags":["Spring Backend Proxy"]}},"/api/adoption/{adoptionId}/complete":{"post":{"description":"\n**Finalize the adoption and mark the adoption post as completed**\n\nThis endpoint is called by the ORIGINAL GUARDIAN after the adoption has been successfully completed on-chain and off-chain.\n\n**When to Call This Endpoint:**\n- After successful ownership transfer on blockchain (POST /pet/accept-transfer/:petDID)\n- After both parties have agreed on the adoption\n- After all paperwork and formalities are complete\n- After pet has been physically transferred to new guardian\n\n**Complete Adoption Flow:**\n```\nStep 1: Original guardian creates adoption post\n  → POST /api/adoption/post\n\nStep 2: New guardian inquires via chat\n  → POST /api/chat/room/create\n  → WebSocket communication\n\nStep 3: Original guardian initiates transfer\n  → POST /pet/prepare-transfer/:petDID (guardian prepares VC)\n\nStep 4: New guardian verifies biometric\n  → POST /pet/verify-transfer/:petDID (nose print verification)\n\nStep 5: New guardian accepts transfer (blockchain)\n  → POST /pet/accept-transfer/:petDID/:adoptionId\n  → On-chain ownership changes\n  → Pet controller updated\n\nStep 6: Original guardian completes adoption (Spring backend)\n  → POST /api/adoption/:adoptionId/complete ← YOU ARE HERE\n  → Adoption post marked as CLOSED\n  → Statistics updated\n```\n\n**What This Endpoint Does:**\n1. Marks adoption post status as \"CLOSED\"\n2. Records adoption completion in Spring database\n3. Updates adoption statistics\n4. Prevents further inquiries on this post\n5. May trigger notifications to participants\n\n**Authorization:**\n- Only the original guardian (post creator) can complete the adoption\n- Requires valid JWT access token\n- Returns 403 if called by non-owner\n\n**Example Request:**\n```javascript\nawait fetch('/api/adoption/123/complete', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken\n  }\n});\n```\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"adoptionId\": 123,\n    \"status\": \"CLOSED\",\n    \"completedAt\": \"2025-10-26T14:30:00Z\",\n    \"message\": \"입양이 성공적으로 완료되었습니다!\"\n  }\n}\n```\n\n**Important Notes:**\n- This endpoint only updates Spring backend, NOT blockchain\n- Blockchain ownership transfer must be done separately via /pet/accept-transfer\n- Once completed, the adoption post cannot be reopened\n- The adoption record is permanent for transparency and statistics\n    ","operationId":"SpringController_finalizeAdoption","parameters":[{"name":"adoptionId","required":true,"in":"path","description":"Adoption post ID to mark as complete","schema":{"type":"number"}}],"responses":{"200":{"description":"Adoption completed successfully"},"401":{"description":"Unauthorized - Invalid or expired token"},"403":{"description":"Forbidden - Only the adoption post creator can complete the adoption"},"404":{"description":"Not Found - Adoption post does not exist"}},"security":[{"access-token":[]}],"summary":"Complete Adoption Process","tags":["Spring Backend Proxy"]}},"/api/story/daily":{"post":{"description":"\n**Share your pet's daily activities and moments with the community**\n\nThis endpoint allows guardians to post daily stories about their pets' activities, behaviors, and special moments.\n\n**Prerequisites:**\n1. Guardian must be registered and authenticated\n2. Pet must be registered in Spring backend (GET /api/pet)\n3. Images must be uploaded to S3 first (POST /common) if including photos\n\n**Complete Daily Story Creation Flow:**\n```javascript\n// 1. (Optional) Upload images to S3\nconst imageResponse = await fetch('/common', { method: 'POST' });\nconst { url: uploadUrl, filename } = await imageResponse.json();\nawait fetch(uploadUrl, { method: 'PUT', body: imageFile });\n\n// 2. Create daily story\nconst storyResponse = await fetch('/api/story/daily', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    petId: 12345,  // From GET /api/pet\n    title: '오늘 첫 산책 다녀왔어요!',\n    content: '오늘 처음으로 공원에서 산책을 했습니다...',\n    images: 'daily-walk-1.jpg,daily-walk-2.jpg'  // Optional\n  })\n});\n```\n\n**Use Cases:**\n- Share daily pet activities and moments\n- Document pet's growth and development\n- Build community engagement\n- Create memories and timeline of pet's life\n- Share tips and experiences with other guardians\n\n**After Creating Story:**\n- Story appears in GET /api/story/daily/stories feed\n- Other users can like (POST /api/like?storyId=X)\n- Other users can comment (POST /api/comment)\n- Story contributes to your pet's story count\n\n**Community Features:**\n- Stories are visible to all users\n- Can receive likes and comments\n- Helps build community of pet lovers\n- Shares experiences and advice\n    ","operationId":"SpringController_createDailyStory","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateDailyStoryDto"}}}},"responses":{"201":{"description":"Daily story created successfully"},"400":{"description":"Bad Request - Invalid pet ID or missing required fields"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Create Daily Story","tags":["Spring Backend Proxy"]}},"/api/story/daily/stories":{"get":{"description":"\n**Retrieve daily stories feed with cursor-based pagination**\n\nBrowse all daily stories shared by the pet guardian community, sorted by recency.\n\n**Pagination:**\n- Uses cursor-based pagination for infinite scroll\n- `cursorId`: The ID of the last story from previous page\n- `size`: Number of stories per page (default: 10, max: 50)\n\n**Example Usage:**\n```javascript\n// Initial load\nconst page1 = await fetch('/api/story/daily/stories?size=10');\n// { stories: [...], nextCursor: 456 }\n\n// Load next page\nconst page2 = await fetch('/api/story/daily/stories?cursorId=456&size=10');\n```\n\n**Returned Story Information:**\n- Story ID, title, content preview\n- Pet information (name, image)\n- Guardian information (nickname, profile)\n- Images attached to story\n- Like count and comment count\n- Creation timestamp\n- Read more link\n\n**No Authentication Required:**\n- Public endpoint - browse community stories\n    ","operationId":"SpringController_getDailyStories","parameters":[{"name":"cursorId","required":false,"in":"query","description":"Cursor for pagination (last story ID from previous page)","schema":{"type":"number"}},{"name":"size","required":false,"in":"query","description":"Number of stories per page (default: 10, max: 50)","schema":{"type":"number"}}],"responses":{"200":{"description":"Daily stories retrieved successfully"}},"summary":"Get All Daily Stories (Feed)","tags":["Spring Backend Proxy"]}},"/api/story/daily/{stories}":{"get":{"description":"\n**Retrieve complete details of a specific daily story**\n\nView full story content, all images, and associated comments/likes.\n\n**Returned Information:**\n- Complete story content (not truncated)\n- All attached images (full size URLs)\n- Pet details (name, breed, age, photo)\n- Guardian information (nickname, profile)\n- Like count and list of users who liked\n- Comment count and preview of recent comments\n- Creation and last updated timestamps\n\n**Use Cases:**\n- Display full story detail page\n- Show all images in gallery\n- View and write comments\n- Like/unlike the story\n\n**Integration:**\n- After viewing, users can like: POST /api/like?storyId=X\n- After viewing, users can comment: POST /api/comment\n\n**No Authentication Required:**\n- Public endpoint - anyone can view story details\n    ","operationId":"SpringController_getDailyStory","parameters":[{"name":"stories","required":true,"in":"path","description":"Daily story ID to retrieve","schema":{"type":"number"}}],"responses":{"200":{"description":"Daily story retrieved successfully"},"404":{"description":"Not Found - Story does not exist"}},"summary":"Get Single Daily Story Detail","tags":["Spring Backend Proxy"]}},"/api/story/review":{"post":{"description":"\n**Share your adoption experience and help promote pet adoption**\n\nThis endpoint allows guardians to post adoption review stories, sharing their experiences with adopting a pet and encouraging others to adopt.\n\n**Prerequisites:**\n1. Guardian must be registered and authenticated\n2. Pet must be registered and owned by the guardian\n3. Pet should have been adopted (not originally owned)\n4. Images must be uploaded to S3 first (POST /common)\n\n**Complete Adoption Review Creation Flow:**\n```javascript\n// 1. Upload images to S3\nconst imageResponse = await fetch('/common', { method: 'POST' });\nconst { url: uploadUrl, filename } = await imageResponse.json();\nawait fetch(uploadUrl, { method: 'PUT', body: imageFile });\n\n// 2. Create review story\nconst reviewResponse = await fetch('/api/story/review', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    petId: 12345,\n    title: '최고의 선택이었어요! 행복한 입양 후기',\n    content: '3개월 전 보호소에서 입양했습니다...',\n    adoptionAgency: '서울 유기견 보호소',\n    adoptionDate: '2024-07-15',\n    images: 'adoption-day.jpg,first-week.jpg'\n  })\n});\n```\n\n**Purpose of Adoption Reviews:**\n- Share positive adoption experiences\n- Encourage others to adopt instead of buying\n- Promote good shelters and rescue organizations\n- Build trust in the adoption process\n- Document the adoption journey\n- Help potential adopters make informed decisions\n\n**Use Cases:**\n- Post after successful adoption\n- Share adaptation process and tips\n- Thank the adoption agency publicly\n- Inspire others to adopt\n\n**After Creating Review:**\n- Review appears in GET /api/story/review/reviews feed\n- Helps promote the adoption agency listed\n- Can receive community support through likes/comments\n- Contributes to adoption statistics\n    ","operationId":"SpringController_createReviewStory","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateReviewStoryDto"}}}},"responses":{"201":{"description":"Adoption review created successfully"},"400":{"description":"Bad Request - Invalid pet ID or missing required fields"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Create Adoption Review Story","tags":["Spring Backend Proxy"]}},"/api/story/review/reviews":{"get":{"description":"\n**Retrieve adoption review stories with cursor-based pagination**\n\nBrowse all adoption review stories shared by guardians who have adopted pets, sorted by recency.\n\n**Pagination:**\n- Uses cursor-based pagination\n- `cursorId`: The ID of the last review from previous page\n- `size`: Number of reviews per page (default: 10, max: 50)\n\n**Returned Review Information:**\n- Review ID, title, content preview\n- Pet information (name, breed, before/after photos)\n- Guardian information (nickname, profile)\n- Adoption agency name\n- Adoption date (how long they've been together)\n- Images showing the adoption journey\n- Like count and comment count\n- Creation timestamp\n\n**Use Cases:**\n- Browse adoption success stories\n- Get inspired to adopt\n- Find recommended adoption agencies\n- Read experiences from other adopters\n- Assess compatibility before adopting\n\n**Community Impact:**\n- Promotes adoption culture\n- Builds trust in rescue organizations\n- Shares realistic expectations\n- Encourages responsible pet ownership\n\n**No Authentication Required:**\n- Public endpoint - inspire potential adopters\n    ","operationId":"SpringController_getReviewStories","parameters":[{"name":"cursorId","required":false,"in":"query","description":"Cursor for pagination (last review ID)","schema":{"type":"number"}},{"name":"size","required":false,"in":"query","description":"Number of reviews per page (default: 10, max: 50)","schema":{"type":"number"}}],"responses":{"200":{"description":"Adoption reviews retrieved successfully"}},"summary":"Get All Adoption Review Stories","tags":["Spring Backend Proxy"]}},"/api/story/review/{reviews}":{"get":{"description":"\n**Retrieve complete details of a specific adoption review**\n\nView full adoption story, all photos, and journey details.\n\n**Returned Information:**\n- Complete review content (full story)\n- All adoption journey images\n- Pet details (name, breed, age at adoption, current age)\n- Guardian information\n- Adoption agency details and contact\n- Adoption date and timeline\n- Before/after comparisons (if available)\n- Community engagement (likes, comments)\n\n**Use Cases:**\n- Read complete adoption success story\n- View adoption journey photos\n- Get detailed information about adoption agency\n- Learn about specific pet breed experiences\n- Assess time needed for pet adaptation\n\n**No Authentication Required:**\n- Public endpoint - anyone can read reviews\n    ","operationId":"SpringController_getReviewStory","parameters":[{"name":"reviews","required":true,"in":"path","description":"Adoption review ID to retrieve","schema":{"type":"number"}}],"responses":{"200":{"description":"Adoption review retrieved successfully"},"404":{"description":"Not Found - Review does not exist"}},"summary":"Get Single Adoption Review Detail","tags":["Spring Backend Proxy"]}},"/api/like":{"post":{"description":"\n**Like or unlike a daily story or adoption review**\n\nThis endpoint allows users to show appreciation for stories by toggling their like status.\n\n**How It Works:**\n- If user hasn't liked the story → adds like\n- If user already liked the story → removes like\n- One user can only like a story once\n- Like count is automatically updated\n\n**Use Cases:**\n- Show appreciation for a story\n- Support community members\n- Bookmark favorite stories\n- Increase engagement\n\n**Example Usage:**\n```javascript\n// Toggle like\nconst response = await fetch('/api/like?storyId=456', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken\n  }\n});\n\n// Response\n{\n  \"result\": {\n    \"storyId\": 456,\n    \"liked\": true,  // or false if unliked\n    \"totalLikes\": 23\n  }\n}\n```\n\n**Integration:**\n- Call after viewing story detail page\n- Update UI immediately for instant feedback\n- Show heart icon as filled/unfilled based on liked status\n\n**Authentication Required:**\n- Must be logged in to like stories\n    ","operationId":"SpringController_toggleLike","parameters":[{"name":"storyId","required":true,"in":"query","description":"Story ID to like/unlike (daily story or review story)","schema":{"type":"number"}}],"responses":{"200":{"description":"Like toggled successfully"},"401":{"description":"Unauthorized - Login required"},"404":{"description":"Not Found - Story does not exist"}},"security":[{"access-token":[]}],"summary":"Toggle Like on Story","tags":["Spring Backend Proxy"]}},"/api/comment":{"get":{"description":"\n**Retrieve comments for a specific story with cursor-based pagination**\n\nView all comments posted on a daily story or adoption review.\n\n**Pagination:**\n- Uses cursor-based pagination for efficient loading\n- `cursor`: The ID of the last comment from previous page\n- `size`: Number of comments per page (default: 20, max: 100)\n\n**Returned Comment Information:**\n- Comment ID, text content\n- Commenter information (nickname, profile image, wallet address)\n- Timestamp (created/updated)\n- Nested replies (if supported)\n- Like count on comment (if supported)\n\n**Example Usage:**\n```javascript\n// Get first page of comments\nconst page1 = await fetch('/api/comment?storyId=456&size=20');\n\n// Load more comments\nconst page2 = await fetch('/api/comment?storyId=456&cursor=123&size=20');\n```\n\n**Use Cases:**\n- Display comment section on story detail page\n- Load more comments on scroll\n- Show community discussion\n- Monitor feedback and questions\n\n**Sorting:**\n- Comments sorted by creation time (newest or oldest first)\n- May include pinned comments at top\n\n**No Authentication Required:**\n- Public endpoint - anyone can view comments\n    ","operationId":"SpringController_getComments","parameters":[{"name":"storyId","required":true,"in":"query","description":"Story ID to get comments for","schema":{"type":"number"}},{"name":"cursor","required":false,"in":"query","description":"Cursor for pagination (last comment ID)","schema":{"type":"number"}},{"name":"size","required":false,"in":"query","description":"Number of comments per page (default: 20, max: 100)","schema":{"type":"number"}}],"responses":{"200":{"description":"Comments retrieved successfully"},"404":{"description":"Not Found - Story does not exist"}},"summary":"Get Comments for Story","tags":["Spring Backend Proxy"]},"post":{"description":"\n**Post a comment on a daily story or adoption review**\n\nShare your thoughts, ask questions, or provide support through comments.\n\n**Complete Comment Flow:**\n```javascript\n// Post a comment\nconst response = await fetch('/api/comment', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    storyId: 456,\n    comment: '정말 귀여운 강아지네요! 행복한 모습이 보기 좋습니다 :)'\n  })\n});\n\n// Response\n{\n  \"result\": {\n    \"commentId\": 789,\n    \"storyId\": 456,\n    \"comment\": \"정말 귀여운 강아지네요!...\",\n    \"author\": {\n      \"walletAddress\": \"0x...\",\n      \"nickname\": \"펫러버\",\n      \"profileImage\": \"...\"\n    },\n    \"createdAt\": \"2025-10-26T15:00:00Z\"\n  }\n}\n```\n\n**Comment Guidelines:**\n- Be respectful and supportive\n- Provide constructive feedback\n- Ask relevant questions\n- Share similar experiences\n- Avoid spam or offensive content\n- Maximum 500 characters\n\n**Use Cases:**\n- Express appreciation\n- Ask about pet care tips\n- Share similar experiences\n- Provide encouragement for adopters\n- Request more information\n\n**After Posting:**\n- Comment appears immediately in GET /api/comment\n- Story author may receive notification\n- Comment count on story is incremented\n- Community can view and respond\n\n**Moderation:**\n- Comments may be subject to community guidelines\n- Report feature may be available\n- Inappropriate comments may be removed\n\n**Authentication Required:**\n- Must be logged in to post comments\n    ","operationId":"SpringController_writeComment","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/WriteCommentDto"}}}},"responses":{"201":{"description":"Comment posted successfully"},"400":{"description":"Bad Request - Invalid story ID or empty comment"},"401":{"description":"Unauthorized - Login required"},"404":{"description":"Not Found - Story does not exist"}},"security":[{"access-token":[]}],"summary":"Write Comment on Story","tags":["Spring Backend Proxy"]}},"/api/chat/room/create":{"post":{"description":"\n**Create a new chat room for adoption communication**\n\nThis endpoint creates a chat room between the adoption post writer (guardian) and an interested adopter.\n\n**Complete Adoption Chat Flow:**\n```\nStep 1: User A creates adoption post → GET adoption post details\nStep 2: User B (current user) calls this endpoint to create chat room\nStep 3: User B connects to WebSocket and joins room\nStep 4: Both users communicate via WebSocket\n```\n\n**Request Body:**\n- `adoptWriterId`: **Wallet address** of the guardian who created the adoption post (lowercase)\n- `adoptId`: The adoption post ID\n- `roomName`: Optional custom name (defaults to adoption post title)\n\n**Participants:**\n- **Guardian (adoptWriterId)**: The user who created the adoption post\n- **Adopter (Current User)**: The authenticated user creating the chat room\n\n**Room Creation Logic:**\n- Room is created only once per `adoptId + adopter` combination\n- If room already exists between these users for this adoption, returns existing room\n- Both participants are automatically added to `chat_participant` table\n- Room is linked to the adoption post\n\n**After Creation - WebSocket Integration:**\n\n1. **Connect to WebSocket:**\n```javascript\nimport io from 'socket.io-client';\n\nconst socket = io('http://localhost:3000/chat', {\n  auth: { token: accessToken },  // JWT token from login\n  transports: ['websocket'],\n  reconnection: false\n});\n\nsocket.on('connect', () => {\n  console.log('Connected:', socket.id);\n});\n```\n\n2. **Join Room and Get Message History:**\n```javascript\nsocket.emit('joinRoom', { roomId: 123 }, (response) => {\n  console.log('Joined:', response.success);\n  console.log('Message history:', response.messages);\n  // messages array contains all previous messages with:\n  // - messageId, senderId, message, isRead, createdAt\n});\n```\n\n3. **Send Messages:**\n```javascript\nsocket.emit('sendMessage', {\n  roomId: 123,\n  message: '안녕하세요! 입양 문의드립니다.'\n}, (response) => {\n  console.log('Message sent:', response.success);\n});\n```\n\n4. **Receive Real-time Messages:**\n```javascript\nsocket.on('message', (data) => {\n  console.log('New message from:', data.senderId);\n  console.log('Message:', data.message);\n  console.log('Created at:', data.createdAt);\n});\n```\n\n5. **Leave Room:**\n```javascript\nsocket.emit('leaveRoom', { roomId: 123 }, (response) => {\n  console.log('Left room:', response.success);\n});\n```\n\n**Message Flow (NestJS ↔ Spring ↔ Redis):**\n```\nUser sends message via WebSocket\n  ↓\nNestJS ChatGateway receives message\n  ↓\nPublishes to Redis channel: \"chat\"\n  ↓\nSpring ChatMessageListener receives message\n  ↓\nSpring saves to database (chat_message table)\n  ↓\nSpring publishes to Redis: \"nestjs:broadcast:{roomId}\"\n  ↓\nNestJS receives broadcast and emits to all connected clients in room\n  ↓\nAll users in room receive message via 'message' event\n```\n\n**Database Tables Created:**\n- `chat_room`: Room info, adoption_id, created_at\n- `chat_participant`: wallet_address, room_id, joined_at\n- `chat_message`: message content, sender_id, room_id, is_read, created_at\n\n**Read Status:**\n- Messages are marked as read when user calls `POST /api/chat/:roomId/enter`\n- OR when user emits `joinRoom` WebSocket event\n- `isRead` field indicates if message has been read by recipient\n\n**Error Cases:**\n- Adoption post not found → 404\n- Invalid wallet address format → 400\n- User not authenticated → 401\n- Room creation fails → 500\n\n**Example Complete Flow:**\n```javascript\n// 1. Create room (REST API)\nconst createRoomResponse = await fetch('/api/chat/room/create', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    adoptWriterId: '0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0',\n    adoptId: 456,\n    roomName: '골든 리트리버 입양 문의'\n  })\n});\nconst { roomId } = await createRoomResponse.json();\n\n// 2. Connect WebSocket\nconst socket = io('http://localhost:3000/chat', {\n  auth: { token: accessToken }\n});\n\n// 3. Join room and get history\nsocket.emit('joinRoom', { roomId }, (response) => {\n  console.log('Messages:', response.messages);\n});\n\n// 4. Listen for messages\nsocket.on('message', (msg) => {\n  console.log('Received:', msg.message);\n});\n\n// 5. Send message\nsocket.emit('sendMessage', { roomId, message: 'Hello!' });\n```\n    ","operationId":"SpringController_createChatRoom","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateChatRoomDto"}}}},"responses":{"201":{"description":"Chat room created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/"}}}},"400":{"description":"Bad Request - Invalid adoption post, wallet address format, or missing required fields"},"401":{"description":"Unauthorized - Invalid or expired token"},"404":{"description":"Not Found - Adoption post does not exist"}},"security":[{"access-token":[]}],"summary":"Create Chat Room for Adoption","tags":["Spring Backend Proxy"]}},"/api/chat/room/list":{"get":{"description":"\n**Retrieve list of all available chat rooms**\n\nThis endpoint returns all chat rooms in the system.\n\n**Use Cases:**\n- Admin dashboard to view all conversations\n- System monitoring and moderation\n- Analytics on adoption communication patterns\n\n**Note:**\n- This endpoint may return ALL rooms in the system\n- For user-specific rooms, consider filtering on the frontend\n- Consider pagination for large datasets\n\n**Response Includes:**\n- Room ID\n- Room name\n- Participants\n- Adoption post information\n- Last message timestamp\n- Unread message count (if applicable)\n    ","operationId":"SpringController_getChatRoomList","parameters":[],"responses":{"200":{"description":"Chat room list retrieved successfully"}},"security":[{"access-token":[]}],"summary":"Get All Chat Rooms","tags":["Spring Backend Proxy"]}},"/api/chat/room/card":{"get":{"description":"\n**Get summary card information for a specific chat room**\n\nThis endpoint retrieves condensed information about a chat room, suitable for displaying in a chat list or room selector.\n\n**Card Information Includes:**\n- Room basic info (ID, name, created date)\n- Participant details\n- Associated adoption post details\n- Last message preview\n- Unread message count for the current user\n- Room status and permissions\n\n**Use Cases:**\n- Display room preview in chat list\n- Show room summary before entering\n- Update room card in real-time when new messages arrive\n\n**Permissions:**\n- User must be a participant in the room to view the card\n- Returns 403 if user is not authorized to view this room\n    ","operationId":"SpringController_getChatRoomCard","parameters":[{"name":"roomId","required":true,"in":"query","description":"Chat room ID to get card information for","schema":{"example":1,"type":"number"}}],"responses":{"200":{"description":"Chat room card retrieved successfully"},"403":{"description":"Forbidden - User is not a participant in this room"},"404":{"description":"Not Found - Chat room does not exist"}},"security":[{"access-token":[]}],"summary":"Get Chat Room Card Information","tags":["Spring Backend Proxy"]}},"/api/chat/{roomId}/enter":{"post":{"description":"\n**Enter a chat room and retrieve complete message history**\n\nThis is an alternative REST API endpoint for entering a room. Most clients should use the WebSocket `joinRoom` event instead, as it provides the same functionality with real-time connection.\n\n**What This Endpoint Does:**\n1. Verifies user is a participant in the room (checks `chat_participant` table)\n2. Marks all messages in the room as read for the current user (`is_read = true`)\n3. Returns complete message history from room creation to now\n4. Does NOT establish WebSocket connection (use WebSocket for real-time)\n\n**Message History Format:**\n```javascript\n{\n  \"result\": {\n    \"roomId\": 123,\n    \"messages\": [\n      {\n        \"messageId\": 1,\n        \"senderId\": \"0x9c34c486ae5fc0def0ec9cd138ddc55e96f0d5e0\",\n        \"senderName\": \"User B\",\n        \"message\": \"안녕하세요! 입양 문의드립니다.\",\n        \"isRead\": true,  // marked as read\n        \"createdAt\": \"2025-10-25T12:30:00.000Z\"\n      },\n      {\n        \"messageId\": 2,\n        \"senderId\": \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\",\n        \"senderName\": \"User A\",\n        \"message\": \"네! 주말에 방문 가능하세요?\",\n        \"isRead\": true,\n        \"createdAt\": \"2025-10-25T12:31:00.000Z\"\n      }\n    ]\n  }\n}\n```\n\n**When to Use This vs WebSocket joinRoom:**\n\n**Use REST API (this endpoint) when:**\n- You want to fetch message history without establishing WebSocket connection\n- Building a message preview or history viewer\n- Pre-loading messages before connecting to WebSocket\n- Implementing \"mark as read\" functionality\n\n**Use WebSocket `joinRoom` event when:**\n- Entering a room for real-time chat (recommended)\n- You need both message history AND real-time updates\n- Building interactive chat interface\n\n**Recommended Flow (WebSocket Only):**\n```javascript\n// Most apps should use WebSocket joinRoom directly:\nconst socket = io('http://localhost:3000/chat', {\n  auth: { token: accessToken }\n});\n\nsocket.on('connect', () => {\n  // Join room - this automatically:\n  // 1. Fetches message history\n  // 2. Marks messages as read\n  // 3. Subscribes to real-time updates\n  socket.emit('joinRoom', { roomId: 123 }, (response) => {\n    console.log('Message history:', response.messages);\n    console.log('Total messages:', response.messages.length);\n  });\n});\n\n// Listen for new messages\nsocket.on('message', (newMessage) => {\n  console.log('New message:', newMessage);\n});\n```\n\n**Alternative Flow (REST + WebSocket):**\n```javascript\n// 1. REST API: Get history and mark as read\nconst historyResponse = await fetch('/api/chat/123/enter', {\n  method: 'POST',\n  headers: { 'Authorization': 'Bearer ' + accessToken }\n});\nconst { messages } = await historyResponse.json();\nconsole.log('History loaded:', messages.length, 'messages');\n\n// 2. WebSocket: Connect for real-time updates\nconst socket = io('http://localhost:3000/chat', {\n  auth: { token: accessToken }\n});\n\nsocket.on('connect', () => {\n  // Still need to join room for real-time updates\n  socket.emit('joinRoom', { roomId: 123 });\n});\n\nsocket.on('message', (msg) => {\n  console.log('Real-time message:', msg);\n});\n```\n\n**Read Status Behavior:**\n- All messages in the room are marked as `isRead = true` for the current user\n- Only affects the current user's read status (other participants unaffected)\n- Read status is permanent (survives reconnection)\n- Useful for \"unread message count\" badge\n\n**Permissions:**\n- User must be in `chat_participant` table for this room\n- Returns 403 if user is not a participant\n- Room creator and adopter are automatically added as participants\n\n**Database Operations:**\n```sql\n-- 1. Verify participation\nSELECT * FROM chat_participant\nWHERE room_id = ? AND wallet_address = ?\n\n-- 2. Mark messages as read\nUPDATE chat_message\nSET is_read = true\nWHERE room_id = ?\n  AND sender_id != ?  -- don't mark own messages\n\n-- 3. Fetch message history\nSELECT * FROM chat_message\nWHERE room_id = ?\nORDER BY created_at ASC\n```\n\n**Error Cases:**\n- User not a participant → 403 Forbidden\n- Room does not exist → 404 Not Found\n- Invalid roomId → 400 Bad Request\n    ","operationId":"SpringController_enterChatRoom","parameters":[{"name":"roomId","required":true,"in":"path","description":"Chat room ID to enter","schema":{"example":123,"type":"number"}}],"responses":{"200":{"description":"Entered room successfully, message history returned with all messages marked as read","content":{"application/json":{"schema":{"example":{"result":{"roomId":123,"messages":[{"messageId":1,"senderId":"0x9c34c486ae5fc0def0ec9cd138ddc55e96f0d5e0","senderName":"User B","message":"안녕하세요! 입양 문의드립니다.","isRead":true,"createdAt":"2025-10-25T12:30:00.000Z"}]}}}}}},"403":{"description":"Forbidden - User is not a participant in this room"},"404":{"description":"Not Found - Chat room does not exist"}},"security":[{"access-token":[]}],"summary":"Enter Chat Room and Get Message History (REST API)","tags":["Spring Backend Proxy"]}},"/api/chat/room/{roomId}/adoption":{"get":{"description":"\n**Retrieve adoption post information associated with a chat room**\n\nEvery chat room is linked to a specific adoption post. This endpoint retrieves the adoption post details to display context within the chat interface.\n\n**Returned Information:**\n- Adoption post ID\n- Pet information (name, species, age, photo)\n- Guardian information (name, wallet address)\n- Post content and description\n- Adoption status\n- Post creation date\n\n**Use Cases:**\n- Display adoption post summary in chat header\n- Show pet details while chatting\n- Verify adoption post status before proceeding with adoption\n- Provide context for the conversation\n\n**Integration with Chat:**\n- Call this when user opens a chat room\n- Display adoption info in chat header or sidebar\n- Update UI if adoption status changes (e.g., adopted by someone else)\n\n**Permissions:**\n- User must be a participant in the chat room\n- Returns 403 if user is not authorized to view this room\n    ","operationId":"SpringController_getChatAdoptionInfo","parameters":[{"name":"roomId","required":true,"in":"path","description":"Chat room ID to get adoption info for","schema":{"example":1,"type":"number"}}],"responses":{"200":{"description":"Adoption info retrieved successfully"},"403":{"description":"Forbidden - User is not a participant in this room"},"404":{"description":"Not Found - Chat room or adoption post does not exist"}},"security":[{"access-token":[]}],"summary":"Get Adoption Post Info for Chat Room","tags":["Spring Backend Proxy"]}},"/api/donation/posts":{"post":{"description":"\n**Create a fundraising campaign for your pet's medical or care expenses**\n\nThis endpoint allows guardians to create donation posts to raise funds (\"bones\") for their pets' needs.\n\n**Complete Donation Post Creation Flow:**\n```javascript\n// 1. Upload supporting images (medical records, vet receipts, etc.)\nconst imageResponse = await fetch('/common', { method: 'POST' });\nconst { url, filename } = await imageResponse.json();\nawait fetch(url, { method: 'PUT', body: imageFile });\n\n// 2. Create donation post\nconst donationResponse = await fetch('/api/donation/posts', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    memberId: 123,  // Usually auto-filled from JWT\n    petId: 12345,\n    title: '긴급 수술비 후원 요청 - 다리 골절 치료',\n    targetAmount: 3000000,  // In KRW\n    deadline: '2025-11-30',\n    category: 'MEDICAL',\n    content: '교통사고로 인해 뒷다리가 골절되었습니다...',\n    images: 'xray.jpg,vet-diagnosis.jpg',\n    bankName: '국민은행',\n    accountNumber: '123-456-789012',\n    accountHolder: '홍길동'\n  })\n});\n```\n\n**Donation Categories:**\n- `MEDICAL`: Surgery, treatment, medication\n- `FOOD`: Food supplies and nutrition\n- `SHELTER`: Housing and facility costs\n- `OTHER`: Other pet care needs\n\n**Dual Currency System:**\n1. **Bones** (platform currency):\n   - Users donate using \"bones\" purchased via POST /api/payment/prepare\n   - Instant transfer, tracked on platform\n   - Used for platform engagement\n\n2. **Fiat Currency** (bank transfer):\n   - Direct bank transfers to provided account\n   - For users who prefer traditional donations\n   - Guardian provides bank details\n\n**Transparency Requirements:**\n- Include medical documentation/receipts\n- Explain specific need and cost breakdown\n- Update progress regularly\n- Report final outcome\n\n**After Creating Post:**\n- Post appears in GET /api/donation/list\n- Users can donate via POST /api/donations\n- Track progress in GET /api/donation/:donationId\n- Update status when goal reached\n\n**Use Cases:**\n- Emergency medical expenses\n- Ongoing treatment costs\n- Food and supplies for rescued pets\n- Shelter operation costs\n    ","operationId":"SpringController_createDonationPost","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateDonationPostDto"}}}},"responses":{"201":{"description":"Donation post created successfully"},"400":{"description":"Bad Request - Invalid data or missing required fields"},"401":{"description":"Unauthorized - Login required"}},"security":[{"access-token":[]}],"summary":"Create Donation Post","tags":["Spring Backend Proxy"]}},"/api/donation/list":{"get":{"description":"\n**Browse donation campaigns with filtering and cursor-based pagination**\n\nView all active and completed donation campaigns to support pets in need.\n\n**Pagination:**\n- Cursor-based pagination\n- `cursor`: ID of last donation from previous page\n- `size`: Items per page (default: 10, max: 100)\n\n**Filtering:**\n- `status`:\n  - `ACTIVE`: Currently fundraising, not yet reached goal\n  - `ACHIEVED`: Goal reached, still open for donations\n  - `CLOSED`: Campaign ended\n- `breed`: Filter by pet breed\n\n**Returned Information:**\n- Donation post details (title, category, deadline)\n- Pet information (name, breed, age, photo)\n- Guardian information\n- Funding progress (current amount / target amount)\n- Status and urgency indicators\n- Bank account details (for direct transfers)\n- Number of donors\n\n**Example Usage:**\n```javascript\n// Get active medical donations\nconst activeMedical = await fetch(\n  '/api/donation/list?status=ACTIVE&size=20'\n);\n\n// Get donations for specific breed\nconst goldenRetrieverDonations = await fetch(\n  '/api/donation/list?breed=Golden Retriever'\n);\n```\n\n**Use Cases:**\n- Browse urgent medical cases\n- Find donation campaigns by breed preference\n- View completed successful campaigns\n- Discover pets that need help\n\n**No Authentication Required:**\n- Public endpoint - encourage community support\n    ","operationId":"SpringController_getDonationList","parameters":[{"name":"cursor","required":false,"in":"query","description":"Cursor for pagination","schema":{"type":"number"}},{"name":"size","required":false,"in":"query","description":"Items per page (default: 10, max: 100)","schema":{"type":"number"}},{"name":"breed","required":false,"in":"query","description":"Filter by pet breed","schema":{"type":"string"}},{"name":"status","required":false,"in":"query","description":"Filter by status","schema":{"enum":["ACTIVE","ACHIEVED","CLOSED"],"type":"string"}}],"responses":{"200":{"description":"Donation list retrieved successfully"}},"summary":"Get All Donation Posts","tags":["Spring Backend Proxy"]}},"/api/donation/{donationId}":{"get":{"description":"\n**Retrieve complete donation campaign details and contribution history**\n\nView full information about a specific donation campaign including all donations received.\n\n**Returned Information:**\n1. **Campaign Details:**\n   - Title, category, content\n   - Pet information (name, breed, photos)\n   - Guardian information\n   - Target amount and current progress\n   - Deadline and status\n   - Bank account details\n   - Supporting images/documents\n\n2. **Donation History** (paginated):\n   - List of all donors (nickname, amount, date)\n   - Recent contributions\n   - Total donors count\n   - Largest single donation\n   - Progress timeline\n\n**Pagination for Donation History:**\n- `cursor`: Last donation ID from previous page\n- `size`: Number of donation records per page\n\n**Example Usage:**\n```javascript\nconst campaignDetails = await fetch('/api/donation/123?size=20');\n\n// Response\n{\n  \"result\": {\n    \"donationPost\": {\n      \"donationId\": 123,\n      \"title\": \"긴급 수술비 후원 요청\",\n      \"category\": \"MEDICAL\",\n      \"targetAmount\": 3000000,\n      \"currentAmount\": 2100000,\n      \"progress\": 70,  // percentage\n      \"status\": \"ACTIVE\",\n      \"deadline\": \"2025-11-30\",\n      ...\n    },\n    \"donationHistory\": [\n      {\n        \"donorNickname\": \"동물사랑\",\n        \"amount\": 50000,  // in bones or KRW\n        \"donatedAt\": \"2025-10-25T10:00:00Z\"\n      },\n      ...\n    ],\n    \"nextCursor\": 456\n  }\n}\n```\n\n**Use Cases:**\n- View campaign before donating\n- Check funding progress\n- See community support level\n- Verify transparency of campaign\n- Review donor history\n\n**No Authentication Required:**\n- Public endpoint - transparency builds trust\n    ","operationId":"SpringController_getDonation","parameters":[{"name":"donationId","required":true,"in":"path","description":"Donation campaign ID","schema":{"type":"number"}},{"name":"cursor","required":false,"in":"query","description":"Cursor for donation history pagination","schema":{"type":"number"}},{"name":"size","required":false,"in":"query","description":"Number of donation records per page","schema":{"type":"number"}}],"responses":{"200":{"description":"Donation details retrieved successfully"},"404":{"description":"Not Found - Donation campaign does not exist"}},"summary":"Get Donation Detail and History","tags":["Spring Backend Proxy"]}},"/api/donations":{"post":{"description":"\n**Donate \"bones\" to a fundraising campaign**\n\nSupport pets in need by donating your bones to their campaign.\n\n**Prerequisites:**\n1. Must have sufficient bones in your account (check with GET /api/donations/bone)\n2. If insufficient bones, purchase more via:\n   - POST /api/payment/prepare\n   - POST /api/payment/approve\n\n**Complete Donation Flow:**\n```javascript\n// 1. Check bone balance\nconst balanceResponse = await fetch('/api/donations/bone', {\n  headers: { 'Authorization': 'Bearer ' + accessToken }\n});\nconst { bones } = await balanceResponse.json();\n\n// 2. If insufficient, buy more bones\nif (bones < requiredBones) {\n  // a. Prepare payment\n  const prepareResponse = await fetch('/api/payment/prepare', {\n    method: 'POST',\n    headers: {\n      'Authorization': 'Bearer ' + accessToken,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ itemId: 2 })  // Bone package ID\n  });\n  const { orderId, amount } = await prepareResponse.json();\n\n  // b. User completes payment via payment gateway (Toss, Iamport, etc.)\n\n  // c. Approve payment\n  await fetch('/api/payment/approve', {\n    method: 'POST',\n    body: JSON.stringify({ orderId, paymentKey, finalAmount: amount })\n  });\n}\n\n// 3. Make donation\nconst donationResponse = await fetch('/api/donations', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    memberId: 456,  // Auto-filled from JWT\n    itemId: 2,  // Bone package (10 bones, 50 bones, etc.)\n    donationId: 123\n  })\n});\n\n// Response\n{\n  \"result\": {\n    \"donationId\": 123,\n    \"amount\": 50,  // bones donated\n    \"remainingBones\": 450,\n    \"totalDonated\": 2150000,  // campaign total\n    \"message\": \"후원해 주셔서 감사합니다!\"\n  }\n}\n```\n\n**Bone Packages (itemId):**\n- Check available packages in system\n- Each itemId represents a specific number of bones\n- Example: itemId 1 = 10 bones, itemId 2 = 50 bones, etc.\n\n**After Donation:**\n- Bones are deducted from your account\n- Donation is recorded in campaign history\n- Campaign progress is updated\n- You can view your donations in GET /api/donations/mine\n\n**Use Cases:**\n- Support medical emergencies\n- Help shelter operations\n- Contribute to community causes\n- Show compassion and solidarity\n    ","operationId":"SpringController_makeDonation","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MakeDonationDto"}}}},"responses":{"201":{"description":"Donation made successfully"},"400":{"description":"Bad Request - Insufficient bones or invalid donation ID"},"401":{"description":"Unauthorized - Login required"},"404":{"description":"Not Found - Donation campaign does not exist"}},"security":[{"access-token":[]}],"summary":"Make Donation","tags":["Spring Backend Proxy"]}},"/api/donations/mine":{"get":{"description":"\n**Retrieve your personal donation history with pagination**\n\nView all donations you have made to various campaigns.\n\n**Pagination:**\n- Cursor-based pagination\n- `cursor`: Last donation ID from previous page\n- `size`: Donations per page (default: 20, max: 100)\n\n**Returned Information:**\n- Donation ID and amount\n- Campaign details (title, pet name, category)\n- Donation date\n- Campaign status (ongoing, achieved, closed)\n- Your impact (percentage of campaign you funded)\n- Total bones donated across all campaigns\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"donations\": [\n      {\n        \"donationId\": 123,\n        \"campaignTitle\": \"긴급 수술비 후원 요청\",\n        \"petName\": \"바둑이\",\n        \"amount\": 50,  // bones\n        \"donatedAt\": \"2025-10-25T10:00:00Z\",\n        \"campaignStatus\": \"ACHIEVED\"\n      },\n      ...\n    ],\n    \"totalDonated\": 500,  // total bones ever donated\n    \"campaignCount\": 12,  // number of campaigns supported\n    \"nextCursor\": 456\n  }\n}\n```\n\n**Use Cases:**\n- Track your contributions\n- View impact on community\n- Generate donation receipts\n- Review supported campaigns\n- Monitor campaign outcomes\n\n**Authentication Required:**\n- Returns only your personal donations\n    ","operationId":"SpringController_getMyDonationHistory","parameters":[{"name":"cursor","required":false,"in":"query","description":"Cursor for pagination","schema":{"type":"number"}},{"name":"size","required":false,"in":"query","description":"Donations per page (default: 20, max: 100)","schema":{"type":"number"}}],"responses":{"200":{"description":"Donation history retrieved successfully"},"401":{"description":"Unauthorized - Login required"}},"security":[{"access-token":[]}],"summary":"Get My Donation History","tags":["Spring Backend Proxy"]}},"/api/donations/bone":{"get":{"description":"\n**Check your current bone balance available for donations**\n\nView how many bones you have available to donate to campaigns.\n\n**What are Bones?**\n- Platform virtual currency for donations\n- Purchase via POST /api/payment/prepare and /api/payment/approve\n- 1 bone ≈ equivalent value in KRW (check current exchange rate)\n- Used exclusively for supporting donation campaigns\n- Cannot be withdrawn, only donated\n\n**Returned Information:**\n- Current bone balance\n- Total bones ever purchased\n- Total bones ever donated\n- Recent bone transactions (purchases/donations)\n- Pending transactions (if any)\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"currentBalance\": 450,\n    \"totalPurchased\": 1000,\n    \"totalDonated\": 550,\n    \"recentTransactions\": [\n      {\n        \"type\": \"PURCHASE\",\n        \"amount\": 500,\n        \"date\": \"2025-10-20T10:00:00Z\"\n      },\n      {\n        \"type\": \"DONATION\",\n        \"amount\": -50,\n        \"campaignTitle\": \"긴급 수술비 후원\",\n        \"date\": \"2025-10-25T10:00:00Z\"\n      }\n    ]\n  }\n}\n```\n\n**Use Cases:**\n- Check balance before donating\n- Decide if need to purchase more bones\n- Track bone usage\n- View transaction history\n\n**How to Get More Bones:**\n1. POST /api/payment/prepare - initiate purchase\n2. Complete payment via payment gateway\n3. POST /api/payment/approve - finalize transaction\n4. Bones added to your account instantly\n\n**Authentication Required:**\n- Returns your personal bone balance\n    ","operationId":"SpringController_getMyBoneBalance","parameters":[],"responses":{"200":{"description":"Bone balance retrieved successfully"},"401":{"description":"Unauthorized - Login required"}},"security":[{"access-token":[]}],"summary":"Get My Bone Balance","tags":["Spring Backend Proxy"]}},"/api/payment/prepare":{"post":{"description":"\n**Initialize payment transaction to purchase bones**\n\nThis endpoint prepares a payment order for purchasing bone packages. After preparation, user completes payment via external gateway (Toss Payments, Iamport, etc.).\n\n**Complete Payment Flow:**\n```javascript\n// Step 1: Prepare payment\nconst prepareResponse = await fetch('/api/payment/prepare', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    itemId: 2  // Bone package ID (e.g., 50 bones for 5000 KRW)\n  })\n});\n\nconst { orderId, amount, itemName, customerEmail } = await prepareResponse.json();\n\n// Step 2: User completes payment via payment gateway\n// Example with Toss Payments\nconst paymentWidget = TossPayments(clientKey);\nawait paymentWidget.requestPayment({\n  method: 'CARD',\n  amount: amount,\n  orderId: orderId,\n  orderName: itemName,\n  customerEmail: customerEmail,\n  successUrl: 'https://yourapp.com/payment/success',\n  failUrl: 'https://yourapp.com/payment/fail'\n});\n\n// Step 3: After payment gateway redirects to successUrl\n// Extract paymentKey from URL params and approve payment\nconst urlParams = new URLSearchParams(window.location.search);\nconst paymentKey = urlParams.get('paymentKey');\n\n// Step 4: Finalize payment\nawait fetch('/api/payment/approve', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    orderId: orderId,\n    paymentKey: paymentKey,\n    finalAmount: amount\n  })\n});\n\n// Bones are now added to your account!\n```\n\n**Bone Packages (itemId):**\n- itemId 1: 10 bones for 1,000 KRW\n- itemId 2: 50 bones for 5,000 KRW\n- itemId 3: 100 bones for 10,000 KRW\n- itemId 4: 500 bones for 50,000 KRW\n(Check system for current packages and pricing)\n\n**Returned Prepare Information:**\n- `orderId`: Unique order identifier for this transaction\n- `amount`: Payment amount in KRW\n- `itemName`: Description of bone package\n- `customerEmail`: User email for payment receipt\n- `expiresAt`: Order expiration time (usually 30 minutes)\n\n**Payment Gateway Integration:**\n- Supports Toss Payments, Iamport, KG Inicis, etc.\n- Choose payment method: credit card, bank transfer, mobile payment\n- Secure PCI-compliant payment processing\n- Automatic fraud detection\n\n**Important Notes:**\n- Order expires after 30 minutes (varies by gateway)\n- Payment must be approved via POST /api/payment/approve\n- Bones added only after successful approval\n- Failed payments do not charge or add bones\n- Refunds handled through payment gateway\n\n**Use Cases:**\n- Purchase bones before donating\n- Buy bones in advance for future donations\n- Support multiple campaigns\n- Participate in platform economy\n    ","operationId":"SpringController_preparePayment","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PreparePaymentDto"}}}},"responses":{"200":{"description":"Payment preparation successful, order created"},"400":{"description":"Bad Request - Invalid item ID"},"401":{"description":"Unauthorized - Login required"}},"security":[{"access-token":[]}],"summary":"Prepare Payment for Bone Purchase","tags":["Spring Backend Proxy"]}},"/api/payment/approve":{"post":{"description":"\n**Finalize payment and credit bones to user account**\n\nThis endpoint verifies the payment with the payment gateway and adds purchased bones to the user's account.\n\n**When to Call:**\n- After user completes payment via payment gateway\n- Payment gateway redirects to your success URL\n- Extract `paymentKey` and `orderId` from URL parameters\n- Call this endpoint to finalize and verify payment\n\n**Complete Approval Flow:**\n```javascript\n// 1. Extract params from payment gateway redirect\nconst urlParams = new URLSearchParams(window.location.search);\nconst paymentKey = urlParams.get('paymentKey');\nconst orderId = urlParams.get('orderId');\nconst finalAmount = parseInt(urlParams.get('amount'));\n\n// 2. Approve payment\nconst approveResponse = await fetch('/api/payment/approve', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    orderId: orderId,\n    paymentKey: paymentKey,\n    finalAmount: finalAmount\n  })\n});\n\nconst result = await approveResponse.json();\n// {\n//   \"success\": true,\n//   \"orderId\": \"ORDER-123\",\n//   \"bones\": 50,  // Bones added\n//   \"newBalance\": 500,  // Total bone balance\n//   \"amount\": 5000,  // KRW charged\n//   \"message\": \"결제가 완료되었습니다!\"\n// }\n\n// 3. Redirect to success page or update UI\nconsole.log(`Successfully purchased ${result.bones} bones!`);\nconsole.log(`New balance: ${result.newBalance} bones`);\n```\n\n**What This Endpoint Does:**\n1. Verifies payment with payment gateway using paymentKey\n2. Checks order exists and matches finalAmount\n3. Confirms payment was actually processed and charged\n4. Prevents duplicate payments (idempotent)\n5. Adds bones to user account in database\n6. Records transaction history\n7. Returns confirmation with new balance\n\n**Security Validations:**\n- Payment key must be valid from gateway\n- Order ID must match prepared order\n- Final amount must match prepared amount (anti-fraud)\n- User must be the order owner\n- Payment must not have been previously approved\n- Gateway confirms payment was successful\n\n**Error Handling:**\n- If payment verification fails → bones not added, order marked as failed\n- If amount mismatch → transaction rejected, fraud alert\n- If duplicate approval → returns original success, bones not added again\n- If gateway returns failure → user shown error, no charge\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"success\": true,\n    \"orderId\": \"ORDER-2025-10-26-ABC123\",\n    \"bones\": 50,\n    \"newBalance\": 500,\n    \"amount\": 5000,\n    \"paymentMethod\": \"CARD\",\n    \"approvedAt\": \"2025-10-26T15:30:00Z\",\n    \"message\": \"결제가 완료되었습니다! 50개의 뼈다귀가 충전되었습니다.\"\n  }\n}\n```\n\n**After Approval:**\n- Bones immediately available for donations\n- Check balance: GET /api/donations/bone\n- View transaction: GET /api/donations/mine\n- Donate to campaigns: POST /api/donations\n\n**Authentication Required:**\n- User must own the order being approved\n    ","operationId":"SpringController_approvePayment","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApprovePaymentDto"}}}},"responses":{"200":{"description":"Payment approved successfully, bones added to account"},"400":{"description":"Bad Request - Payment verification failed, amount mismatch, or invalid payment key"},"401":{"description":"Unauthorized - Login required"},"404":{"description":"Not Found - Order does not exist"}},"security":[{"access-token":[]}],"summary":"Approve Payment and Add Bones","tags":["Spring Backend Proxy"]}},"/api/admin":{"get":{"description":"\n**Retrieve complete list of all registered guardians and their pets**\n\nThis endpoint is restricted to ADMIN role users and provides comprehensive oversight of all platform members.\n\n**Admin Access Only:**\n- Requires ADMIN role in guardian registration\n- Regular USER role will receive 403 Forbidden\n- Used for platform administration and moderation\n\n**Pagination:**\n- Cursor-based pagination using ISO date-time\n- `cursor`: ISO timestamp of last member from previous page (e.g., \"2025-10-26T12:00:00Z\")\n- `size`: Members per page (default: 10, max: 100)\n\n**Returned Information:**\n1. **Member Details:**\n   - Guardian wallet address\n   - Email and phone (if available)\n   - Name and nickname\n   - Profile information\n   - Role (USER or ADMIN)\n   - Registration date\n   - Last active date\n   - Account status (active, suspended, etc.)\n\n2. **Pet Information for Each Member:**\n   - List of all pets owned by guardian\n   - Pet names, species, breeds\n   - Pet DIDs (if blockchain-registered)\n   - Adoption status\n   - Registration dates\n\n3. **Activity Statistics:**\n   - Number of adoption posts created\n   - Number of daily stories posted\n   - Number of review stories posted\n   - Donation campaigns created\n   - Total donations made/received\n   - Community engagement metrics\n\n**Example Usage:**\n```javascript\n// Get first page\nconst page1 = await fetch('/api/admin?size=20', {\n  headers: { 'Authorization': 'Bearer ' + adminAccessToken }\n});\n\nconst { members, nextCursor } = await page1.json();\n\n// Get next page\nconst page2 = await fetch(`/api/admin?cursor=${nextCursor}&size=20`, {\n  headers: { 'Authorization': 'Bearer ' + adminAccessToken }\n});\n```\n\n**Example Response:**\n```json\n{\n  \"result\": {\n    \"members\": [\n      {\n        \"walletAddress\": \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\",\n        \"email\": \"user@example.com\",\n        \"name\": \"홍길동\",\n        \"nickname\": \"펫러버\",\n        \"role\": \"USER\",\n        \"registeredAt\": \"2025-01-15T10:00:00Z\",\n        \"lastActive\": \"2025-10-26T14:00:00Z\",\n        \"pets\": [\n          {\n            \"petId\": 12345,\n            \"petDID\": \"did:ethr:besu:0xabc...\",\n            \"name\": \"바둑이\",\n            \"species\": \"DOG\",\n            \"breed\": \"Golden Retriever\"\n          }\n        ],\n        \"stats\": {\n          \"adoptionPosts\": 2,\n          \"dailyStories\": 15,\n          \"reviewStories\": 1,\n          \"donationCampaigns\": 0,\n          \"totalDonationsMade\": 500\n        }\n      }\n    ],\n    \"nextCursor\": \"2025-01-14T10:00:00Z\",\n    \"totalMembers\": 1500,\n    \"hasMore\": true\n  }\n}\n```\n\n**Admin Use Cases:**\n- Monitor platform growth and activity\n- Identify suspicious accounts or spam\n- Provide customer support\n- Generate analytics and reports\n- Moderate content and users\n- Verify shelter/organization accounts (ADMIN role applications)\n- Track adoption success rates\n- Monitor donation campaigns for transparency\n\n**Security:**\n- Admin role verified via JWT token and guardian role in database\n- Sensitive data (private keys, passwords) never exposed\n- Audit logging for admin access\n- Rate limiting to prevent abuse\n\n**Authorization Check:**\n```\n1. Extract wallet address from JWT token\n2. Query guardian table for user role\n3. If role !== 'ADMIN' → return 403 Forbidden\n4. If role === 'ADMIN' → proceed with query\n```\n\n**Performance:**\n- Optimized queries with proper indexing\n- Cursor-based pagination prevents offset issues\n- Response caching for frequently accessed data\n- Database read replicas for scalability\n    ","operationId":"SpringController_getAdminMembers","parameters":[{"name":"cursor","required":false,"in":"query","description":"Cursor for pagination (ISO date-time string of last member from previous page)","schema":{"type":"string"}},{"name":"size","required":false,"in":"query","description":"Number of members per page (default: 10, max: 100)","schema":{"type":"number"}}],"responses":{"200":{"description":"Member list retrieved successfully"},"401":{"description":"Unauthorized - Login required"},"403":{"description":"Forbidden - Admin role required"}},"security":[{"access-token":[]}],"summary":"Get All Members and Pets (Admin Only)","tags":["Spring Backend Proxy"]}},"/common":{"post":{"description":"\n**Get a presigned URL for direct S3 image upload**\n\nThis endpoint generates a temporary presigned URL that allows clients to upload images directly to AWS S3.\n\n**Use Cases:**\n- Pet registration photos\n- Adoption post images\n- Daily story images\n- Review story images\n- Guardian profile pictures\n\n**Upload Flow:**\n1. Call this endpoint to get a presigned URL\n2. Upload your image file directly to the presigned URL using PUT request\n3. Use the S3 object key returned in the response for subsequent API calls\n\n**Important:**\n- Presigned URLs are temporary and expire after a set time\n- Upload should use PUT method directly to the presigned URL\n- Content-Type should match the image type (e.g., image/jpeg, image/png)\n- Maximum file size and allowed formats may be enforced\n\n**Example Usage:**\n```javascript\n// Step 1: Get presigned URL\nconst { url, key } = await fetch('/common', {\n  method: 'POST',\n  headers: { 'Authorization': 'Bearer YOUR_TOKEN' }\n}).then(r => r.json());\n\n// Step 2: Upload image to S3\nawait fetch(url, {\n  method: 'PUT',\n  body: imageFile,\n  headers: { 'Content-Type': 'image/jpeg' }\n});\n\n// Step 3: Use the key in your API request\nawait fetch('/pet/register', {\n  method: 'POST',\n  body: JSON.stringify({ imageKey: key, ... })\n});\n```\n        ","operationId":"CommonController_createPresignedUrl","parameters":[],"responses":{"200":{"description":"Presigned URL generated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PresignedUrlResponseDto"}}}},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Generate S3 Presigned URL for Image Upload","tags":["Common"]}},"/email/send-code":{"post":{"description":"\n**Send a 6-digit verification code to user's email**\n\nThis is the first step in the email verification process, required for guardian registration.\n\n**Guardian Registration Flow:**\n1. **Step 1 (This endpoint):** Send verification code to email\n2. Step 2: User checks email for 6-digit code\n3. Step 3: User submits code via POST /email/verify-code\n4. Step 4: System verifies email and registers account in VC service\n\n**Important:**\n- User must be authenticated (JWT token required)\n- Verification code expires after 10 minutes\n- Only one active code per wallet address at a time\n- Sending a new code invalidates the previous one\n- Maximum 5 attempts per hour to prevent spam\n\n**Code Delivery:**\n- Email subject: \"DogCatPaw - Email Verification Code\"\n- Code format: 6 numeric digits (e.g., 123456)\n- Valid for: 10 minutes\n- Sender: noreply@dogcatpaw.com (or configured sender)\n\n**Use Cases:**\n- Guardian registration email verification\n- Email change verification (future)\n- Account recovery (future)\n\n**Rate Limiting:**\n- Maximum 5 code requests per wallet address per hour\n- Cooldown period: 60 seconds between requests\n\n**Example Flow:**\n```javascript\n// Step 1: Request verification code\nconst response = await fetch('/email/send-code', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer YOUR_ACCESS_TOKEN',\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({ email: 'user@example.com' })\n});\n\n// Step 2: User receives email and enters code\n// Step 3: Verify code (see POST /email/verify-code)\n```\n    ","operationId":"EmailController_sendCode","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SendVerificationCodeDto"}}}},"responses":{"200":{"description":"Verification code sent successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SendVerificationCodeResponseDto"}}}},"400":{"description":"Bad Request - Invalid email format or rate limit exceeded"},"401":{"description":"Unauthorized - Invalid or expired token"},"429":{"description":"Too Many Requests - Rate limit exceeded"}},"security":[{"access-token":[]}],"summary":"Send Email Verification Code","tags":["Email"]}},"/email/verify-code":{"post":{"description":"\n**Verify the 6-digit email code and complete account registration**\n\nThis is the final step in the email verification process. Upon successful verification:\n1. Email is marked as verified\n2. Account is registered in VC service (via gRPC)\n3. User can proceed with guardian registration\n\n**Verification Process:**\n1. User submits the 6-digit code received via email\n2. System validates code against stored hash\n3. System checks code expiration (10 minutes)\n4. If valid, registers account in VC service\n5. Returns success with account registration confirmation\n\n**Code Validation:**\n- Code must be exactly 6 digits\n- Code must not be expired (10 minutes validity)\n- Code must match the one sent to the wallet address\n- Maximum 3 verification attempts before code is invalidated\n\n**Failed Attempts:**\n- Remaining attempts are returned in response\n- After 3 failed attempts, user must request a new code\n- Failed attempts are tracked per wallet address\n\n**Account Registration:**\n- On successful verification, account is registered in VC service\n- Registration creates user record with wallet address\n- Email is stored as verified\n- If registration fails, email is still marked as verified\n\n**Next Steps After Success:**\n1. Email verified ✅\n2. Account registered in VC service ✅\n3. User can now proceed to guardian registration (POST /api/guardian/register)\n\n**Example Flow:**\n```javascript\n// After receiving code via email\nconst response = await fetch('/email/verify-code', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer YOUR_ACCESS_TOKEN',\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({ code: '123456' })\n});\n\nif (response.success) {\n  // Email verified, proceed to guardian registration\n  console.log('Email verified! Proceeding to guardian registration...');\n}\n```\n\n**Error Handling:**\n- Invalid code: Returns error with remaining attempts\n- Expired code: User must request new code\n- No code found: User must request code first\n- Account registration fails: Email still verified, warning returned\n    ","operationId":"EmailController_verifyCode","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerifyEmailCodeDto"}}}},"responses":{"200":{"description":"Email verified and account registered successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerifyEmailCodeResponseDto"}}}},"400":{"description":"Bad Request - Invalid code format, expired code, or verification failed"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Verify Email Code and Register Account","tags":["Email"]}},"/api/guardian/register":{"post":{"description":"\n**Register guardian account on blockchain after email verification**\n\nThis endpoint completes the guardian registration process by registering the guardian on the GuardianRegistry smart contract and synchronizing data to VC service and Spring backend.\n\n**Prerequisites:**\n1. User must complete email verification via POST /email/verify-code\n2. User must have valid JWT access token (from POST /api/auth/login)\n3. User wallet must not be already registered on blockchain\n\n**Complete Guardian Registration Flow:**\n```\nStep 1: POST /email/send-code - Send verification code to email\nStep 2: POST /email/verify-code - Verify code → Creates auth record in VC service\nStep 3: This endpoint - Register guardian on blockchain\n```\n\n**What This Endpoint Does:**\n\n**Immediate Actions (Blocking):**\n1. Checks email verification status in VC service\n2. Validates email is provided (required field)\n3. Checks if wallet already registered on blockchain (prevent duplicates)\n4. Calculates personal data hash from email, phone, name, timestamp\n5. **Executes GuardianRegistry.registerGuardian() on blockchain** (blocks until confirmed)\n\n**Background Jobs (Non-blocking - BullMQ):**\n6. Queues VC synchronization (creates/updates guardian VC)\n7. **If profile image provided:** Queues image move (temp → permanent) → Then Spring sync\n8. **If no profile image:** Directly queues Spring registration (USER or ADMIN role)\n\n**Transaction Execution Flow:**\n```\n1. Validate email verification ✅\n   ↓\n2. Execute blockchain registration ✅ Blocks until confirmed\n   ↓\n3. Queue VC sync (background) → Create GuardianVC\n4a. If profileUrl: Queue image move → Spring sync after\n4b. If no profileUrl: Queue Spring registration directly\n```\n\n**Request Body:**\n```javascript\n{\n  email: \"user@example.com\",  // Required - must be verified\n  role: \"USER\",  // USER or ADMIN\n  phone: \"+82-10-1234-5678\",  // Optional\n  name: \"홍길동\",  // Optional\n  nickname: \"멋쟁이\",  // Optional\n  profileUrl: \"abc123-def456.jpg\",  // Optional - S3 temp filename\n  gender: \"M\",  // Optional - M or F\n  old: 30,  // Optional - age\n  address: \"서울시 강남구\",  // Optional - physical address\n  verificationMethod: 2,  // Optional - default 2 (Email)\n  signedTx: \"0xf86c...\"  // Optional - required in production mode\n}\n```\n\n**Response - With Profile Image:**\n```javascript\n{\n  success: true,\n  authId: 123,  // VC service auth record ID\n  txHash: \"0xabcdef1234567890...\",  // Blockchain transaction hash\n  blockNumber: 12345,  // Block number\n  vcJobId: \"job-abc-123\",  // BullMQ VC sync job ID\n  imageMoveJobId: \"job-def-456\",  // BullMQ image move job ID\n  message: \"Guardian registered on blockchain. Profile image will be moved, then synced to Spring.\"\n}\n```\n\n**Response - Without Profile Image:**\n```javascript\n{\n  success: true,\n  authId: 123,\n  txHash: \"0xabcdef1234567890...\",\n  blockNumber: 12345,\n  vcJobId: \"job-abc-123\",\n  springJobId: \"job-ghi-789\",  // Direct Spring registration job ID\n  message: \"Guardian registered on blockchain. Syncing data in background.\"\n}\n```\n\n**Blockchain Smart Contract:**\n```solidity\n// GuardianRegistry.sol\nfunction registerGuardian(\n  address _guardian,\n  bytes32 _personalDataHash,\n  string memory _ncpStorageURI,\n  uint8 _verificationMethod\n) public {\n  require(!guardians[_guardian].exists, \"Already registered\");\n  guardians[_guardian] = Guardian({\n    personalDataHash: _personalDataHash,\n    ncpStorageURI: _ncpStorageURI,\n    verificationMethod: _verificationMethod,\n    registeredAt: block.timestamp,\n    exists: true\n  });\n  emit GuardianRegistered(_guardian, _personalDataHash);\n}\n```\n\n**Personal Data Hash Calculation:**\n```javascript\nconst personalDataHash = ethers.keccak256(\n  ethers.toUtf8Bytes(JSON.stringify({\n    email: \"user@example.com\",\n    phone: \"+82-10-1234-5678\",\n    name: \"홍길동\",\n    timestamp: Date.now()\n  }))\n);\n// Result: 0x1234567890abcdef...\n```\n\n**Background Jobs Details:**\n\n**1. VC Synchronization Job (BullMQ):**\n- Creates or updates GuardianVC in VC service\n- Stores guardian information (email, phone, name)\n- Links wallet address to auth record\n- Used for authentication and profile management\n\n**2. Image Move Job (BullMQ):**\n- Moves profile image: `temp/{filename}` → `guardian-profile-photo/{walletAddress}/{filename}`\n- Updates Spring backend with permanent image URL\n- Registers USER or ADMIN in Spring database\n- Async processing (non-blocking)\n\n**3. Spring Registration Job (BullMQ):**\n- **USER role:** Registers in users table with profile data\n- **ADMIN role:** Registers in admins table for shelter/organization management\n- Stores email, phone, name, nickname, gender, age, address\n- Links wallet address to Spring user/admin record\n\n**Role-Based Registration:**\n\n**USER Role:**\n- General pet guardians\n- Can register pets, adopt pets, participate in community\n- Registered in Spring `users` table\n\n**ADMIN Role:**\n- Shelters, rescue organizations, veterinary clinics\n- Can post adoption listings, manage multiple pets\n- Registered in Spring `admins` table\n\n**Error Cases:**\n\n**Email Not Verified:**\n```javascript\n{\n  success: false,\n  error: \"이메일 인증이 필요합니다! 먼저 인증해주세요!\"\n}\n```\n\n**Email Missing:**\n```javascript\n{\n  success: false,\n  error: \"이메일은 필수 항목입니다\"\n}\n```\n\n**Already Registered:**\n```javascript\n{\n  success: false,\n  error: \"이미 블록체인에 등록된 주소입니다. 중복 등록은 불가능합니다.\",\n  alreadyRegistered: true\n}\n```\n\n**HTTP Status Codes:**\n- 200: Success (check success field)\n- 400: Bad Request (email missing, validation failed)\n- 401: Unauthorized (invalid token)\n- 503: Service Unavailable (blockchain error)\n\n**Important Notes:**\n- Email verification via POST /email/verify-code is **required** before registration\n- Wallet address is automatically extracted from JWT token\n- Personal data hash is calculated server-side (privacy protection)\n- Only blockchain registration is blocking - VC and Spring sync are async\n- Profile image is optional but recommended for community features\n- Duplicate registration is prevented (one wallet = one guardian)\n\n**Use Cases:**\n- Pet owner registration: Register to manage pets and participate in adoption\n- Shelter registration: Register as ADMIN to post adoption listings\n- Rescue organization: Manage rescued pets and adoption process\n    ","operationId":"GuardianController_registerGuardian","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateGuardianDto"}}}},"responses":{"200":{"description":"Guardian registered successfully on blockchain, background jobs queued","content":{"application/json":{"schema":{"oneOf":[{"description":"With profile image","example":{"success":true,"authId":123,"txHash":"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890","blockNumber":12345,"vcJobId":"job-abc-123-def-456","imageMoveJobId":"job-def-456-ghi-789","message":"Guardian registered on blockchain. Profile image will be moved, then synced to Spring."}},{"description":"Without profile image","example":{"success":true,"authId":123,"txHash":"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890","blockNumber":12345,"vcJobId":"job-abc-123-def-456","springJobId":"job-ghi-789-jkl-012","message":"Guardian registered on blockchain. Syncing data in background."}}]}}}},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"bearer":[]}],"summary":"Register Guardian - Complete Guardian Registration on Blockchain","tags":["Guardian"]}},"/api/guardian/link-pet/{petDID}":{"post":{"description":"\n**Execute signed transaction to link pet to guardian's profile on blockchain**\n\nThis endpoint submits the signed transaction from POST /api/guardian/prepare-link-pet/:petDID to the blockchain, linking the pet to the guardian's profile.\n\n**Complete Link Pet Flow:**\n```\nStep 1: POST /api/guardian/prepare-link-pet/:petDID - Get transaction data\nStep 2: Client signs transaction with wallet private key\nStep 3: This endpoint - Submit signed transaction → Blockchain execution\n```\n\n**What This Endpoint Does:**\n1. Validates guardian is authenticated (JWT token)\n2. Validates pet DID parameter\n3. Executes signed GuardianRegistry.linkPet() transaction on blockchain\n4. Returns transaction hash and block number\n5. Links pet to guardian's profile (guardian → pets mapping)\n\n**Request Parameters:**\n- `:petDID`: Pet DID to link (e.g., \"did:ethr:besu:0xabcdef...\")\n\n**Request Body:**\n```javascript\n{\n  signedTx: \"0xf86c808504a817c800825208941234567890123456789012345678901234567890880de0b6b3a76400008025a0...\"\n}\n```\n\n**Complete Flow Example:**\n```javascript\n// Step 1: Prepare transaction data\nconst prepareResponse = await fetch(`/api/guardian/prepare-link-pet/${petDID}`, {\n  method: 'POST',\n  headers: { 'Authorization': 'Bearer ' + accessToken }\n});\nconst { transactionData } = await prepareResponse.json();\n\n// Step 2: Sign transaction\nconst wallet = new ethers.Wallet(privateKey, provider);\nconst signedTx = await wallet.signTransaction({\n  to: transactionData.to,\n  data: transactionData.data,\n  gasLimit: ethers.toBeHex(3000000),\n  gasPrice: ethers.toBeHex(0),\n  value: 0,\n  nonce: await provider.getTransactionCount(wallet.address),\n  chainId: 1337\n});\n\n// Step 3: Submit signed transaction\nconst linkResponse = await fetch(`/api/guardian/link-pet/${petDID}`, {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({ signedTx })\n});\n\nconst result = await linkResponse.json();\nconsole.log('Pet linked! TX Hash:', result.txHash);\nconsole.log('Block Number:', result.blockNumber);\n```\n\n**Response - Success:**\n```javascript\n{\n  success: true,\n  txHash: \"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890\",\n  blockNumber: 12345,\n  message: \"Pet did:ethr:besu:0xabcdef... linked to guardian 0xe9ebc...\"\n}\n```\n\n**Response - Error:**\n```javascript\n{\n  success: false,\n  error: \"Guardian not registered on blockchain\"\n}\n```\n\n**Blockchain Smart Contract:**\n```solidity\n// GuardianRegistry.sol\nfunction linkPet(string memory _petDID) public {\n  require(guardians[msg.sender].exists, \"Guardian not registered\");\n  guardianToPets[msg.sender].push(_petDID);\n  emit PetLinked(msg.sender, _petDID);\n}\n```\n\n**What Happens On-Chain:**\n1. Validates guardian exists in GuardianRegistry\n2. Adds pet DID to guardian's pet list (guardianToPets mapping)\n3. Emits PetLinked event for indexing\n4. Transaction is mined and confirmed\n\n**Use Cases:**\n- **After Pet Registration:** Link newly registered pet to guardian profile\n- **After Pet Transfer:** New owner links received pet to their profile\n- **Profile Management:** Guardian organizing their pet portfolio\n\n**GuardianRegistry vs PetDIDRegistry:**\n- **PetDIDRegistry:** Source of truth for pet ownership (controller field)\n- **GuardianRegistry:** Auxiliary mapping for quick guardian → pets lookup\n- **Limitation:** GuardianRegistry requires guardian signature (cannot be done in background job)\n- **Recommendation:** Always verify ownership from PetDIDRegistry controller field\n\n**Important Notes:**\n- Guardian must be registered first (POST /api/guardian/register)\n- Pet DID must exist on blockchain (POST /pet/register)\n- Transaction execution blocks until confirmed on blockchain\n- Pet can be linked to multiple guardians (not enforced on-chain)\n- True ownership is determined by PetDIDRegistry.controller field\n- This is a convenience feature for guardian profile management\n\n**Error Cases:**\n- Guardian not registered → Error message returned\n- Pet DID not found → Transaction will fail\n- Invalid signature → Transaction execution error\n- Nonce conflict → Retryable error\n- Insufficient gas → Transaction fails\n\n**HTTP Status Codes:**\n- 200: Success (check success field)\n- 400: Bad Request (validation failed)\n- 401: Unauthorized (invalid token)\n- 503: Service Unavailable (blockchain error)\n\n**Transaction Fees:**\n- Gas price: 0 (private network)\n- Gas limit: 3,000,000\n- No ETH transfer (value: 0)\n    ","operationId":"GuardianController_linkPet","parameters":[{"name":"petDID","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Pet linked successfully to guardian profile","content":{"application/json":{"schema":{"example":{"success":true,"txHash":"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890","blockNumber":12345,"message":"Pet did:ethr:besu:0xabcdef... linked to guardian 0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"}}}}},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"bearer":[]}],"summary":"Link Pet to Guardian - Execute Signed Transaction","tags":["Guardian"]}},"/api/guardian/prepare-link-pet/{petDID}":{"post":{"description":"\n**Prepare transaction data for linking a pet to guardian's profile**\n\nThis endpoint prepares the transaction data for GuardianRegistry.linkPet() function. The guardian must sign this transaction and submit it via POST /api/guardian/link-pet/:petDID.\n\n**What This Endpoint Does:**\n1. Validates guardian is authenticated (JWT token)\n2. Prepares transaction data for GuardianRegistry.linkPet() function\n3. Returns unsigned transaction data for guardian to sign\n4. Provides instructions for next step\n\n**Use Cases:**\n- Guardian wants to link an existing pet to their profile\n- Pet was registered but not linked to guardian's profile yet\n- Guardian received pet transfer and wants to link it\n\n**Request Parameters:**\n- `:petDID`: Pet DID to link (e.g., \"did:ethr:besu:0xabcdef...\")\n\n**Response:**\n```javascript\n{\n  success: true,\n  transactionData: {\n    to: \"0x...\",  // GuardianRegistry contract address\n    data: \"0x...\",  // linkPet function call data\n    from: \"0x...\",  // Guardian wallet address\n    gasLimit: \"3000000\",\n    gasPrice: \"0\",\n    value: \"0\"\n  },\n  instruction: \"Sign this transaction with your wallet and call POST /api/guardian/link-pet/:petDID with the signed transaction\"\n}\n```\n\n**Next Steps:**\n```javascript\n// 1. Get transaction data from this endpoint\nconst prepareResponse = await fetch(`/api/guardian/prepare-link-pet/${petDID}`, {\n  method: 'POST',\n  headers: { 'Authorization': 'Bearer ' + accessToken }\n});\nconst { transactionData } = await prepareResponse.json();\n\n// 2. Sign the transaction\nconst wallet = new ethers.Wallet(privateKey);\nconst signedTx = await wallet.signTransaction({\n  to: transactionData.to,\n  data: transactionData.data,\n  gasLimit: ethers.toBeHex(3000000),\n  gasPrice: ethers.toBeHex(0),\n  value: 0,\n  nonce: await provider.getTransactionCount(wallet.address),\n  chainId: 1337\n});\n\n// 3. Submit signed transaction\nconst linkResponse = await fetch(`/api/guardian/link-pet/${petDID}`, {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({ signedTx })\n});\n```\n\n**Blockchain Smart Contract:**\n```solidity\n// GuardianRegistry.sol\nfunction linkPet(string memory _petDID) public {\n  require(guardians[msg.sender].exists, \"Guardian not registered\");\n  guardianToPets[msg.sender].push(_petDID);\n  emit PetLinked(msg.sender, _petDID);\n}\n```\n\n**Important Notes:**\n- This endpoint only prepares transaction data (no blockchain execution)\n- Guardian must sign transaction client-side with their private key\n- Signed transaction is submitted via POST /api/guardian/link-pet/:petDID\n- Guardian must be registered on blockchain first (POST /api/guardian/register)\n- Pet DID must exist on blockchain (POST /pet/register)\n\n**Error Cases:**\n- Invalid token → 401 Unauthorized\n- Pet DID not found → 400 Bad Request\n- Guardian not registered → 400 Bad Request\n    ","operationId":"GuardianController_prepareLinkPet","parameters":[{"name":"petDID","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Transaction data prepared successfully","content":{"application/json":{"schema":{"example":{"success":true,"transactionData":{"to":"0x1234567890123456789012345678901234567890","data":"0xabcdef...","from":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0","gasLimit":"3000000","gasPrice":"0","value":"0"},"instruction":"Sign this transaction with your wallet and call POST /api/guardian/link-pet/:petDID with the signed transaction"}}}}},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"bearer":[]}],"summary":"Prepare Guardian Link Pet Transaction - Generate Signing Data","tags":["Guardian"]}},"/pet/prepare-registration":{"post":{"description":"\n**Prepare all signing data for pet registration (3 signatures required)**\n\nThis is the first step in the pet registration process. This endpoint analyzes the nose print biometric data and prepares three transactions for the guardian to sign.\n\n**Complete Pet Registration Flow:**\n```\nStep 0: Upload images to S3 (POST /common for presigned URLs)\nStep 1: This endpoint - Get signing data (3 transactions)\nStep 2: Client signs all 3 transactions locally\nStep 3: POST /pet/register - Submit signatures → Background processing\n```\n\n**What This Endpoint Does:**\n1. Verifies guardian is registered in VC service\n2. Downloads nose print image from S3 temp folder\n3. Sends image to ML server for feature vector extraction (biometric signature)\n4. Calculates Pet DID from feature vector: `did:ethr:besu:{keccak256(vector)}`\n5. Prepares 3 transactions for guardian to sign:\n   - **Pet Registration TX**: Register Pet DID on blockchain\n   - **Guardian Link TX**: Link pet to guardian's profile\n   - **VC Signing Data**: Guardian consent for VC issuance\n\n**Before Calling This Endpoint:**\nYou must upload images to S3 using POST /common:\n```javascript\n// 1. Get presigned URL for nose image\nconst noseUrlResponse = await fetch('/common', {\n  method: 'POST',\n  headers: { 'Authorization': 'Bearer ' + accessToken }\n});\nconst { url: nosePresignedUrl } = await noseUrlResponse.json();\n\n// 2. Upload nose image to S3\nawait fetch(nosePresignedUrl, {\n  method: 'PUT',\n  body: noseImageFile,\n  headers: { 'Content-Type': 'image/jpeg' }\n});\n\n// 3. Extract filename from URL\nconst noseFileName = new URL(nosePresignedUrl).pathname.split('/').pop();\n\n// 4. Repeat for pet profile images\n// 5. Call this endpoint with filenames\n```\n\n**Pet DID Generation:**\n```\n1. Nose image → ML Server → Feature vector (512-dimensional array)\n2. Feature vector → keccak256 hash → Feature Vector Hash\n3. Pet DID = \"did:ethr:besu:{featureVectorHash}\"\n\nExample: did:ethr:besu:0x1234567890abcdef...\n```\n\n**Response - 3 Transactions to Sign:**\n\n**1. Pet Registration Transaction:**\n```javascript\n{\n  to: \"0x...\",  // PetDIDRegistry contract address\n  data: \"0x...\", // registerPetDID function call\n  gasLimit: \"3000000\",\n  gasPrice: \"0\",\n  value: \"0\",\n  from: \"0x...\",  // Guardian address\n}\n```\n\n**2. Guardian Link Transaction:**\n```javascript\n{\n  to: \"0x...\",  // GuardianRegistry contract address\n  data: \"0x...\", // linkPet function call\n  gasLimit: \"3000000\",\n  gasPrice: \"0\",\n  value: \"0\",\n  from: \"0x...\",  // Guardian address\n}\n```\n\n**3. VC Signing Data:**\n```javascript\n{\n  message: {\n    vcType: \"GuardianIssuedPetVC\",\n    sub: \"did:ethr:besu:0x...\",  // Pet DID\n    guardian: \"0x...\",\n    biometricHash: \"0x...\",\n    petData: { petName, breed, age, ... },\n    issuedAt: \"2025-10-25T12:00:00Z\",\n    nonce: \"random-string\"\n  },\n  messageHash: \"0x...\"  // keccak256 of message for signing\n}\n```\n\n**Next Steps After Receiving Response:**\n```javascript\n// 1. Sign Pet Registration TX\nconst petTx = {\n  to: response.petRegistrationTxData.to,\n  data: response.petRegistrationTxData.data,\n  gasLimit: ethers.toBeHex(3000000),\n  gasPrice: ethers.toBeHex(0),\n  value: 0,\n  nonce: await provider.getTransactionCount(wallet.address),\n  chainId: 1337\n};\nconst petSignedTx = await wallet.signTransaction(petTx);\n\n// 2. Sign Guardian Link TX (nonce + 1)\nconst linkTx = {\n  to: response.guardianLinkTxData.to,\n  data: response.guardianLinkTxData.data,\n  gasLimit: ethers.toBeHex(3000000),\n  gasPrice: ethers.toBeHex(0),\n  value: 0,\n  nonce: await provider.getTransactionCount(wallet.address) + 1,\n  chainId: 1337\n};\nconst linkSignedTx = await wallet.signTransaction(linkTx);\n\n// 3. Sign VC Message\nconst vcSignature = await wallet.signMessage(response.vcSigningData.messageHash);\n\n// 4. Submit all signatures to POST /pet/register\n```\n\n**Important Notes:**\n- This endpoint does NOT submit transactions to blockchain\n- It only prepares signing data and calculates Pet DID\n- Guardian Link TX must use nonce+1 (executes after Pet Registration)\n- All 3 signatures are submitted together in next step\n\n**Image Requirements:**\n- Nose image: Clear, high-resolution nose print photo\n- Format: JPEG or PNG\n- Size: Recommended < 5MB\n- Quality: Must be clear enough for ML feature extraction\n\n**Error Cases:**\n- Guardian not registered → 400 Bad Request\n- Nose image not found in S3 → 400 Bad Request\n- ML server fails to extract features → 400 Bad Request\n- Invalid image format → 400 Bad Request\n    ","operationId":"PetController_prepareRegistration","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreatePetDto"}}}},"responses":{"200":{"description":"Signing data prepared successfully","content":{"application/json":{"schema":{"example":{"success":true,"petDID":"did:ethr:besu:0x1234567890abcdef...","message":"Sign all three transactions and submit to POST /pet/register","petRegistrationTxData":{"to":"0x...","data":"0x...","from":"0x...","gasLimit":"3000000","gasPrice":"0","value":"0"},"guardianLinkTxData":{"to":"0x...","data":"0x...","from":"0x...","gasLimit":"3000000","gasPrice":"0","value":"0"},"vcSigningData":{"message":{"vcType":"GuardianIssuedPetVC","sub":"did:ethr:besu:0x...","guardian":"0x...","biometricHash":"0x...","petData":{},"issuedAt":"2025-10-25T12:00:00Z","nonce":"abc123"},"messageHash":"0x..."},"nextStep":"Sign petRegistrationTx, guardianLinkTx, and vcMessageHash, then call POST /pet/register with all signatures"}}}}},"400":{"description":"Bad Request - Guardian not registered, image not found, or ML extraction failed"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Step 1: Prepare Pet Registration - Generate Signing Data","tags":["Pet"]}},"/pet/register":{"post":{"description":"\n**Submit signed transactions and complete pet registration**\n\nThis is the final step of pet registration. After signing all 3 transactions from Step 1 (prepare-registration), submit them here for blockchain execution and background processing.\n\n**What This Endpoint Does:**\n\n**Immediate Actions (Blocking):**\n1. Re-extracts nose print feature vector from S3 image\n2. Verifies Pet DID matches (ensures same biometric data)\n3. **Submits Pet Registration TX to blockchain** (blocks until confirmed)\n4. Saves feature vector to S3 permanent storage\n\n**Background Jobs (Non-blocking - BullMQ):**\n5. Queues Guardian Link transaction execution\n6. Queues VC (Verifiable Credential) creation\n7. Queues image move from temp → permanent storage\n8. Queues Spring backend synchronization\n\n**Transaction Execution Order:**\n```\n1. Pet Registration TX (immediate) ✅ Blocks until confirmed\n   ↓\n2. Guardian Link TX (queued) → Executes in background\n3. VC Creation (queued) → Waits for Guardian Link\n4. Image Move (queued) → Triggers Spring sync when done\n```\n\n**Complete Flow Example:**\n```javascript\n// After signing in Step 1, submit signatures:\n\nconst registerData = {\n  // Same pet data as prepare-registration\n  noseImage: noseFileName,\n  images: petImageFileNames.join(','),\n  petName: 'Max',\n  specifics: 'dog',\n  breed: 'GOLDEN_RETRIEVER',\n  old: 3,\n  gender: 'MALE',\n  weight: 25.5,\n  color: '황금색',\n  feature: '활발함',\n  neutral: true,\n\n  // Signed transactions from Step 1\n  signedTx: petSignedTx,  // Pet Registration (executed immediately)\n  guardianLinkSignedTx: guardianLinkSignedTx,  // Guardian Link (queued)\n  vcSignature: vcSignature,  // VC consent (queued)\n  vcMessage: JSON.stringify(vcMessage)  // Must be string\n};\n\nconst response = await fetch('/pet/register', {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify(registerData)\n});\n\nconst result = await response.json();\nconsole.log('Pet DID:', result.petDID);\nconsole.log('TX Hash:', result.txHash);\nconsole.log('Block Number:', result.blockNumber);\nconsole.log('Background Jobs:', result.jobs);\n```\n\n**Response - Immediate Results:**\n```javascript\n{\n  success: true,\n  petDID: \"did:ethr:besu:0x1234567890abcdef...\",\n  txHash: \"0xabcdef1234567890...\",  // Pet Registration TX\n  blockNumber: 12345,\n  message: \"Pet registered successfully! Background jobs queued.\",\n  jobs: {\n    guardianLink: \"job-uuid-1\",  // BullMQ job ID\n    vc: \"job-uuid-2\",\n    imageMove: \"job-uuid-3\"\n  },\n  note: \"Images will be moved to permanent storage, then Spring sync will be triggered automatically.\"\n}\n```\n\n**Background Jobs Details:**\n\n**1. Guardian Link Job (BullMQ):**\n- Submits guardianLinkSignedTx to blockchain\n- Links pet to guardian's profile in GuardianRegistry\n- Guardian can view pet in their pet list\n\n**2. VC Creation Job (BullMQ):**\n- Creates GuardianIssuedPetVC in VC service\n- Stores VC in database\n- VC contains pet data + biometric hash + guardian signature\n- Can be used for pet ownership proof\n\n**3. Image Move Job (BullMQ):**\n- Moves images from S3 temp folder → permanent folders:\n  - Nose print: `nose-print-photo/{petDID}/filename.jpg`\n  - Profile images: `pet-profile-photo/{petDID}/filename.jpg`\n- Triggers Spring backend sync after completion\n- Spring creates pet record in MySQL/PostgreSQL\n\n**Pet DID Verification:**\n- Endpoint re-extracts feature vector from nose image\n- Recalculates Pet DID and compares with prepare-registration result\n- Ensures no tampering between prepare and register calls\n- If mismatch detected → 400 Bad Request\n\n**Error Handling - Blockchain TX Fails:**\n```javascript\n{\n  success: false,\n  error: \"Pet registration failed\",\n  errorCode: \"NONCE_TOO_LOW\",  // or other error codes\n  retryable: true,  // or false\n  txHash: \"0x...\",  // May be present\n  blockNumber: null,\n  details: { ... }  // Additional error info\n}\n```\n\n**Error Codes:**\n- `NONCE_TOO_LOW`: Transaction nonce conflict (retryable)\n- `INSUFFICIENT_FUNDS`: Not enough gas (not retryable)\n- `EXECUTION_REVERTED`: Contract rejected TX (check pet DID uniqueness)\n- `TIMEOUT`: Blockchain timeout (retryable)\n\n**HTTP Status Codes:**\n- 200: Success\n- 400: Bad Request (invalid data, DID mismatch, contract revert)\n- 401: Unauthorized (invalid token)\n- 503: Service Unavailable (retryable blockchain errors)\n\n**Important Notes:**\n- Only Pet Registration TX is executed immediately\n- Guardian Link and VC creation are queued (may take seconds)\n- Images are moved asynchronously\n- Spring sync happens after image move completes\n- You can check job status using job IDs (if monitoring endpoint exists)\n\n**Required Fields:**\n- All pet data fields (same as prepare-registration)\n- `signedTx`: Pet Registration signed transaction (required)\n- `guard ianLinkSignedTx`: Guardian Link signed TX (optional but recommended)\n- `vcSignature`: VC consent signature (optional but recommended)\n- `vcMessage`: Original VC message as JSON string (required if vcSignature provided)\n\n**Validation:**\n- Pet data must match prepare-registration call\n- Nose image must produce same Pet DID\n- Signed transactions must be valid\n- Guardian must still be registered\n    ","operationId":"PetController_registerPet","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreatePetDto"}}}},"responses":{"200":{"description":"Pet registered successfully on blockchain, background jobs queued","content":{"application/json":{"schema":{"example":{"success":true,"petDID":"did:ethr:besu:0x1234567890abcdef1234567890abcdef12345678","txHash":"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890","blockNumber":12345,"message":"Pet registered successfully! Background jobs queued.","jobs":{"guardianLink":"job-abc123-def456","vc":"job-def456-ghi789","imageMove":"job-ghi789-jkl012"},"note":"Images will be moved to permanent storage, then Spring sync will be triggered automatically."}}}}},"400":{"description":"Bad Request - Invalid data, Pet DID mismatch, guardian not registered, or blockchain contract revert"},"401":{"description":"Unauthorized - Invalid or expired token"},"503":{"description":"Service Unavailable - Retryable blockchain error (nonce conflict, timeout, etc.)","content":{"application/json":{"schema":{"example":{"success":false,"error":"Pet registration failed","errorCode":"NONCE_TOO_LOW","retryable":true,"txHash":null,"blockNumber":null,"details":{"message":"Nonce too low. Current nonce is 5, transaction nonce is 3."}}}}}}},"security":[{"access-token":[]}],"summary":"Step 2: Submit Signatures and Register Pet on Blockchain","tags":["Pet"]}},"/pet/prepare-transfer/{petDID}":{"post":{"description":"\n**Initiate pet ownership transfer by preparing signing data for new guardian**\n\nThis is the first step of the pet ownership transfer (adoption) process. Only the current pet controller (owner) can initiate a transfer.\n\n**Complete Ownership Transfer Flow:**\n```\nStep 1: This endpoint - Current guardian prepares VC signing data\nStep 2: New guardian signs message off-chain (client-side)\nStep 3: POST /pet/verify-transfer/:petDID - New guardian uploads nose print for biometric verification\nStep 4: POST /pet/accept-transfer/:petDID/:adoptionId - New guardian submits signature + verification proof → Blockchain execution\n```\n\n**What This Endpoint Does:**\n1. Verifies Pet DID exists on blockchain\n2. Verifies caller is current controller (owner) of the pet\n3. Fetches pet's biometric data (feature vector hash) from storage\n4. Prepares VC transfer signing message for new guardian to sign\n5. Returns signing data with message and messageHash\n\n**Authorization:**\n- Only current pet controller can call this endpoint\n- Caller must provide valid JWT access token\n- Pet DID must exist on blockchain\n\n**Request Body:**\n```javascript\n{\n  newGuardianAddress: \"0x1234567890123456789012345678901234567890\",  // New owner address\n  petData: {\n    petName: \"Max\",\n    breed: \"GOLDEN_RETRIEVER\",\n    old: 3,\n    gender: \"MALE\",\n    weight: 25.5,\n    color: \"황금색\",\n    feature: \"활발함\",\n    neutral: true,\n    specifics: \"dog\"\n  }\n}\n```\n\n**Response - VC Signing Data:**\n```javascript\n{\n  success: true,\n  message: {\n    vc: {\n      vcType: \"GuardianPetOwnershipTransferVC\",\n      credentialSubject: {\n        previousGuardian: \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\",  // Current owner\n        guardian: \"0x1234567890123456789012345678901234567890\",  // New owner\n        petDID: \"did:ethr:besu:0xabcdef...\",\n        biometricHash: \"0x...\",\n        petData: { ... }\n      },\n      issuedAt: \"2025-10-25T12:00:00Z\",\n      nonce: \"random-string\"\n    }\n  },\n  messageHash: \"0x...\",  // keccak256 of message for signing\n  nextStep: \"New guardian must sign and call POST /pet/accept-transfer/:petDID\"\n}\n```\n\n**Next Steps After Receiving Response:**\n```javascript\n// 1. New guardian receives message and messageHash\n// 2. New guardian signs messageHash with their wallet\nconst wallet = new ethers.Wallet(newGuardianPrivateKey);\nconst signature = await wallet.signMessage(ethers.getBytes(response.messageHash));\n\n// 3. New guardian uploads nose print for biometric verification\n// See POST /pet/verify-transfer/:petDID\n\n// 4. New guardian submits signature + verification proof\n// See POST /pet/accept-transfer/:petDID/:adoptionId\n```\n\n**Use Cases:**\n- Pet adoption: Transfer ownership to adopter after successful adoption\n- Guardian change: Transfer to family member or friend\n- Rescue/rehoming: Transfer to new guardian through authorized channels\n\n**Important Notes:**\n- This endpoint does NOT execute blockchain transactions\n- It only prepares signing data for the new guardian\n- Actual transfer happens in Step 4 (accept-transfer)\n- Biometric verification (Step 3) is required before acceptance\n- Previous guardian VC will be invalidated upon successful transfer\n- New guardian VC will be created in background job\n\n**Error Cases:**\n- Pet DID not found → 400 Bad Request\n- Caller is not current controller → 400 Bad Request\n- Biometric data not found → 400 Bad Request\n- Invalid token → 401 Unauthorized\n    ","operationId":"PetController_prepareTransfer","parameters":[{"name":"petDID","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"VC signing data prepared successfully","content":{"application/json":{"schema":{"example":{"success":true,"message":{"vc":{"vcType":"GuardianPetOwnershipTransferVC","credentialSubject":{"previousGuardian":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0","guardian":"0x1234567890123456789012345678901234567890","petDID":"did:ethr:besu:0xabcdef...","biometricHash":"0x...","petData":{"petName":"Max","breed":"GOLDEN_RETRIEVER","old":3}},"issuedAt":"2025-10-25T12:00:00Z","nonce":"abc123"}},"messageHash":"0x1234567890abcdef...","nextStep":"New guardian must sign and call POST /pet/accept-transfer/:petDID"}}}}},"400":{"description":"Bad Request - Pet DID not found, caller not controller, or biometric data missing"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Step 1: Prepare Pet Ownership Transfer - Generate VC Signing Data","tags":["Pet"]}},"/pet/verify-transfer/{petDID}":{"post":{"description":"\n**Verify new guardian has physical custody of pet through biometric nose print matching**\n\nThis is the critical biometric verification step in ownership transfer. The new guardian must upload a nose print photo of the pet to prove they have physical custody.\n\n**Complete Ownership Transfer Flow:**\n```\nStep 1: POST /pet/prepare-transfer/:petDID - Current guardian prepares signing data\nStep 2: New guardian signs message off-chain (client-side)\nStep 3: This endpoint - New guardian uploads nose print for verification\nStep 4: POST /pet/accept-transfer/:petDID/:adoptionId - Complete transfer on blockchain\n```\n\n**What This Endpoint Does:**\n1. New guardian uploads nose print image of the pet\n2. Moves image from temp → permanent storage (`nose-print-photo/{petDID}/`)\n3. Sends image to ML server for feature vector extraction\n4. Compares new vector with stored pet feature vector (cosine similarity)\n5. Verifies similarity ≥ 50% threshold (configurable, currently 50%)\n6. Records verification on blockchain (background job)\n7. Returns verification proof token (valid for 10 minutes)\n\n**Before Calling This Endpoint:**\nNew guardian must upload nose print image to S3 temp folder:\n\n```javascript\n// 1. Get presigned URL for nose image\nconst response = await fetch('/common', {\n  method: 'POST',\n  headers: { 'Authorization': 'Bearer ' + newGuardianAccessToken }\n});\nconst { url: presignedUrl } = await response.json();\n\n// 2. Upload nose image to S3\nawait fetch(presignedUrl, {\n  method: 'PUT',\n  body: noseImageFile,\n  headers: { 'Content-Type': 'image/jpeg' }\n});\n\n// 3. Extract filename from URL\nconst fileName = new URL(presignedUrl).pathname.split('/').pop();\n\n// 4. Call this endpoint with filename\nconst verifyResponse = await fetch(`/pet/verify-transfer/${petDID}`, {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + newGuardianAccessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({ image: fileName })\n});\n```\n\n**Request Body:**\n```javascript\n{\n  image: \"abc123-def456-ghi789.jpg\"  // Filename from S3 temp folder\n}\n```\n\n**Response - Successful Verification (≥50% similarity):**\n```javascript\n{\n  success: true,\n  similarity: 85,  // Percentage (0-100)\n  message: \"비문 검증 성공! 이제 소유권 이전을 완료할 수 있습니다.\",\n  verificationProof: {\n    petDID: \"did:ethr:besu:0xabcdef...\",\n    newGuardian: \"0x1234567890123456789012345678901234567890\",\n    similarity: 85,\n    verifiedAt: \"2025-10-25T12:00:00.000Z\",\n    nonce: \"xyz789\"\n  },\n  proofHash: \"0x1234567890abcdef...\",  // keccak256 of proof\n  nextStep: \"Call POST /pet/accept-transfer/:petDID with signature and this proof\"\n}\n```\n\n**Response - Failed Verification (<50% similarity):**\n```javascript\n{\n  success: false,\n  similarity: 35,\n  message: \"비문이 일치하지 않습니다. 소유권 이전을 진행할 수 없습니다.\",\n  error: \"비문이 일치하지 않습니다. 소유권 이전을 진행할 수 없습니다.\",\n  threshold: 50\n}\n```\n\n**Biometric Verification Details:**\n\n**ML Comparison Process:**\n```\n1. Download new nose image from S3: nose-print-photo/{petDID}/{filename}\n2. ML Server extracts feature vector from new image (512-dim array)\n3. ML Server loads stored pet feature vector from S3\n4. Calculate cosine similarity: similarity = cos(newVector, storedVector)\n5. Convert to percentage: similarityPercent = similarity * 100\n6. Compare against threshold (50%)\n```\n\n**Similarity Threshold:**\n- **50%+**: Verification success → Can proceed to accept-transfer\n- **<50%**: Verification failed → Cannot proceed (potential fraud/wrong pet)\n\n**Verification Proof:**\n- Generated upon successful verification\n- Contains: petDID, newGuardian address, similarity score, timestamp, nonce\n- **Valid for 10 minutes only** (expires after that)\n- Must be submitted with accept-transfer request\n- Hashed with keccak256 for integrity verification\n\n**Blockchain Recording (Background Job):**\nAfter successful verification, a background job records the verification event on blockchain:\n- Purpose code: 2 (ownership_transfer)\n- Similarity score: 90 (hardcoded for privacy - actual similarity not revealed on-chain)\n- Verifier: New guardian address\n- Async processing via BullMQ\n\n**Security Features:**\n- Only new guardian (JWT token holder) can verify their own transfer\n- Image is permanently stored (cannot be reused for fraud)\n- Proof expires in 10 minutes (prevents replay attacks)\n- Blockchain record creates audit trail\n- ML server comparison is deterministic and tamper-proof\n\n**Use Cases:**\n- Pet adoption: Adopter proves physical custody before accepting ownership\n- Fraud prevention: Ensures person accepting ownership has actual pet\n- Audit trail: On-chain verification record for disputes\n\n**Important Notes:**\n- This endpoint can be called multiple times (e.g., if first photo unclear)\n- Each call generates new verification proof\n- Only the latest proof is valid for accept-transfer\n- Image is moved to permanent storage (not deleted from temp)\n- ML server must be running and accessible\n- Threshold is currently 50% (may be adjusted based on ML model accuracy)\n\n**Error Cases:**\n- Pet DID not found → 400 Bad Request\n- Image not found in S3 → 400 Bad Request\n- ML server extraction failed → 400 Bad Request\n- ML server comparison failed → 400 Bad Request\n- Similarity below threshold → 200 OK but success: false\n- Invalid token → 401 Unauthorized\n    ","operationId":"PetController_verifyTransfer","parameters":[{"name":"petDID","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TranferImageUrlDto"}}}},"responses":{"200":{"description":"Biometric verification completed (check success field for result)","content":{"application/json":{"schema":{"oneOf":[{"description":"Verification succeeded (≥50% similarity)","example":{"success":true,"similarity":85,"message":"비문 검증 성공! 이제 소유권 이전을 완료할 수 있습니다.","verificationProof":{"petDID":"did:ethr:besu:0xabcdef...","newGuardian":"0x1234567890123456789012345678901234567890","similarity":85,"verifiedAt":"2025-10-25T12:00:00.000Z","nonce":"xyz789"},"proofHash":"0x1234567890abcdef...","nextStep":"Call POST /pet/accept-transfer/:petDID with signature and this proof"}},{"description":"Verification failed (<50% similarity)","example":{"success":false,"similarity":35,"message":"비문이 일치하지 않습니다. 소유권 이전을 진행할 수 없습니다.","error":"비문이 일치하지 않습니다. 소유권 이전을 진행할 수 없습니다.","threshold":50}}]}}}},"400":{"description":"Bad Request - Pet DID not found, image not found in S3, or ML server failed"},"401":{"description":"Unauthorized - Invalid or expired token"}},"security":[{"access-token":[]}],"summary":"Step 3: Verify New Guardian Biometric - Upload Nose Print for Matching","tags":["Pet"]}},"/pet/accept-transfer/{petDID}/{adoptionId}":{"post":{"description":"\n**Complete pet ownership transfer by executing blockchain controller change**\n\nThis is the final and most critical step of ownership transfer. The new guardian submits their signature and biometric verification proof to execute the on-chain controller change.\n\n**Complete Ownership Transfer Flow:**\n```\nStep 1: POST /pet/prepare-transfer/:petDID - Current guardian prepares signing data\nStep 2: New guardian signs message off-chain (client-side)\nStep 3: POST /pet/verify-transfer/:petDID - New guardian uploads nose print (≥50% match)\nStep 4: This endpoint - Execute blockchain TX + background VC processing\n```\n\n**What This Endpoint Does:**\n\n**Immediate Actions (Blocking):**\n1. Validates new guardian signature on VC transfer message\n2. Validates biometric verification proof (must be <10 minutes old)\n3. **Executes PetDIDRegistry.changeController() on blockchain** (blocks until confirmed)\n4. Returns transaction hash and block number\n\n**Background Jobs (Non-blocking - BullMQ):**\n5. Invalidates previous guardian's VC (marks as revoked)\n6. Creates new VC for new guardian with pet ownership credentials\n7. Updates Spring backend adoption record status\n\n**Transaction Execution Flow:**\n```\n1. Validate signature + verification proof (immediate) ✅\n   ↓\n2. Execute changeController TX (immediate) ✅ Blocks until confirmed\n   ↓\n3. Queue VC transfer job (background) → Invalidate old + Create new VC\n4. Queue Spring sync job (background) → Update adoption status\n```\n\n**Request Parameters:**\n- `:petDID`: Pet DID identifier (e.g., \"did:ethr:besu:0xabcdef...\")\n- `:adoptionId`: Adoption record ID from Spring backend\n\n**Request Body:**\n```javascript\n{\n  signature: \"0xabcdef...\",  // New guardian signature from Step 2\n  message: {\n    vc: {\n      vcType: \"GuardianPetOwnershipTransferVC\",\n      credentialSubject: {\n        previousGuardian: \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\",\n        guardian: \"0x1234567890123456789012345678901234567890\",  // Must match caller\n        petDID: \"did:ethr:besu:0xabcdef...\",\n        biometricHash: \"0x...\",\n        petData: { ... }\n      },\n      issuedAt: \"2025-10-25T12:00:00Z\",\n      nonce: \"abc123\"\n    }\n  },\n  petData: {\n    petName: \"Max\",\n    breed: \"GOLDEN_RETRIEVER\",\n    old: 3,\n    gender: \"MALE\",\n    weight: 25.5,\n    color: \"황금색\",\n    feature: \"활발함\",\n    neutral: true,\n    specifics: \"dog\"\n  },\n  verificationProof: {\n    petDID: \"did:ethr:besu:0xabcdef...\",\n    newGuardian: \"0x1234567890123456789012345678901234567890\",\n    similarity: 85,\n    verifiedAt: \"2025-10-25T12:00:00.000Z\",\n    nonce: \"xyz789\"\n  },\n  signedTx: \"0xf86c...\"  // Signed changeController transaction\n}\n```\n\n**Complete Flow Example:**\n```javascript\n// Prerequisites: Steps 1-3 completed\n// Step 1: Current guardian called prepare-transfer\n// Step 2: New guardian signed message\n// Step 3: New guardian verified biometric (got verificationProof)\n\n// Step 4: New guardian accepts transfer\nconst acceptData = {\n  signature: newGuardianSignature,  // From Step 2\n  message: vcTransferMessage,       // From Step 1\n  petData: {\n    petName: 'Max',\n    breed: 'GOLDEN_RETRIEVER',\n    old: 3,\n    gender: 'MALE',\n    weight: 25.5,\n    color: '황금색',\n    feature: '활발함',\n    neutral: true,\n    specifics: 'dog'\n  },\n  verificationProof: verificationProofFromStep3,  // From Step 3\n  signedTx: changeControllerSignedTx  // Signed transaction\n};\n\nconst response = await fetch(`/pet/accept-transfer/${petDID}/${adoptionId}`, {\n  method: 'POST',\n  headers: {\n    'Authorization': 'Bearer ' + newGuardianAccessToken,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify(acceptData)\n});\n\nconst result = await response.json();\nconsole.log('Transfer Complete!');\nconsole.log('TX Hash:', result.txHash);\nconsole.log('Block Number:', result.blockNumber);\nconsole.log('Similarity:', result.similarity);\nconsole.log('VC Job ID:', result.vcTransferJobId);\n```\n\n**Response - Immediate Results:**\n```javascript\n{\n  success: true,\n  txHash: \"0xabcdef1234567890...\",  // PetDIDRegistry.changeController TX\n  blockNumber: 12345,\n  similarity: 85,  // From verification proof\n  vcTransferJobId: \"job-uuid-123\",  // BullMQ job ID\n  message: \"Pet ownership transferred successfully on blockchain. VC processing queued.\"\n}\n```\n\n**Blockchain Controller Change:**\n```solidity\n// PetDIDRegistry smart contract\nfunction changeController(string memory _did, address _newController) public {\n  require(msg.sender == didToController[_did], \"Only current controller\");\n  address oldController = didToController[_did];\n  didToController[_did] = _newController;\n  emit ControllerChanged(_did, oldController, _newController);\n}\n```\n\n**Background Jobs Details:**\n\n**1. VC Transfer Job (BullMQ):**\n- Invalidates previous guardian's VC (marks as revoked in database)\n- Creates new VC for new guardian:\n  - VC Type: GuardianPetOwnershipTransferVC\n  - Credent ial Subject: { previousGuardian, guardian, petDID, biometricHash, petData }\n  - New guardian signature included as proof of consent\n- Stores new VC in VC service database\n\n**2. Spring Backend Sync Job (BullMQ):**\n- Updates adoption record status in Spring backend\n- Marks adoption as \"completed\" in MySQL/PostgreSQL\n- Updates pet owner information\n- Triggers notification to previous guardian (optional)\n\n**Validation Checks:**\n\n**1. Signature Validation:**\n- Message guardian must match caller's address (new guardian)\n- Signature must be valid ECDSA signature on message\n\n**2. Verification Proof Validation:**\n- Proof newGuardian must match caller's address\n- Proof petDID must match URL parameter\n- Proof must be less than 10 minutes old (timestamp check)\n- Proof must have valid structure\n\n**3. Blockchain Transaction:**\n- SignedTx must be valid signed transaction\n- Transaction must call changeController() function\n- Current controller is NOT updated in GuardianRegistry (requires separate signatures)\n\n**GuardianRegistry Sync Limitation:**\nThe GuardianRegistry contract (which maintains guardian → pets mapping) is NOT automatically synced because:\n- linkPet() and unlinkPet() require msg.sender to be guardian\n- Background jobs cannot use user's private key for signing\n- Solution: PetDIDRegistry controller is the single source of truth\n- GuardianRegistry is auxiliary mapping only\n\n**Error Handling - Validation Failures:**\n```javascript\n{\n  success: false,\n  error: \"Not the designated new guardian\"  // or other error messages\n}\n```\n\n**Error Handling - Blockchain TX Fails:**\n```javascript\n{\n  success: false,\n  error: \"Pet transfer failed\",\n  errorCode: \"NONCE_TOO_LOW\",  // or INSUFFICIENT_FUNDS, EXECUTION_REVERTED, etc.\n  retryable: true,\n  txHash: null,\n  blockNumber: null,\n  details: { ... }\n}\n```\n\n**Error Codes:**\n- `NONCE_TOO_LOW`: Transaction nonce conflict (retryable)\n- `INSUFFICIENT_FUNDS`: Not enough gas (not retryable)\n- `EXECUTION_REVERTED`: Contract rejected (caller not current controller, or pet DID not found)\n- `TIMEOUT`: Blockchain timeout (retryable)\n\n**HTTP Status Codes:**\n- 200: Success\n- 400: Bad Request (invalid signature, expired proof, guardian mismatch)\n- 401: Unauthorized (invalid token)\n- 503: Service Unavailable (retryable blockchain errors)\n\n**Security Features:**\n- Only new guardian (message recipient) can accept transfer\n- Biometric verification proof required (proves physical custody)\n- Proof expires in 10 minutes (prevents replay attacks)\n- Signature verification prevents impersonation\n- Blockchain execution is atomic (either succeeds fully or fails)\n\n**Important Notes:**\n- Only blockchain controller change is immediate (blocks response)\n- VC processing is async (may take seconds to complete)\n- Spring sync is async (adoption status updated in background)\n- GuardianRegistry is NOT synced automatically\n- Previous guardian loses blockchain controller rights immediately\n- New guardian can now control pet DID and transfer again\n\n**Required Fields:**\n- `signature`: New guardian signature (required)\n- `message`: VC transfer message (required)\n- `petData`: Pet data for new VC (required)\n- `verificationProof`: Biometric proof from Step 3 (required, <10 min old)\n- `signedTx`: Signed changeController transaction (required in production)\n\n**Use Cases:**\n- Pet adoption completion: Adopter accepts ownership after successful application\n- Guardian change: Family member accepts pet responsibility\n- Rescue transfer: New rescue organization accepts custody\n    ","operationId":"PetController_acceptTransfer","parameters":[{"name":"petDID","required":true,"in":"path","schema":{"type":"string"}},{"name":"adoptionId","required":true,"in":"path","schema":{"type":"number"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AcceptTransferDto"}}}},"responses":{"200":{"description":"Pet ownership transferred successfully on blockchain, VC processing queued","content":{"application/json":{"schema":{"example":{"success":true,"txHash":"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890","blockNumber":12345,"similarity":85,"vcTransferJobId":"job-abc123-def456-ghi789","message":"Pet ownership transferred successfully on blockchain. VC processing queued."}}}}},"400":{"description":"Bad Request - Invalid signature, expired verification proof, guardian mismatch, or blockchain contract revert"},"401":{"description":"Unauthorized - Invalid or expired token"},"503":{"description":"Service Unavailable - Retryable blockchain error (nonce conflict, timeout, etc.)","content":{"application/json":{"schema":{"example":{"success":false,"error":"Pet transfer failed","errorCode":"NONCE_TOO_LOW","retryable":true,"txHash":null,"blockNumber":null,"details":{"message":"Nonce too low. Current nonce is 5, transaction nonce is 3."}}}}}}},"security":[{"access-token":[]}],"summary":"Step 4: Accept Pet Ownership Transfer - Execute Blockchain Transaction","tags":["Pet"]}},"/pet/history/{petDID}":{"get":{"description":"\n**Retrieve complete ownership transfer history for a pet from blockchain**\n\nThis endpoint fetches all historical controller changes (ownership transfers) for a specific pet DID from the blockchain indexer service, with fallback to direct blockchain querying.\n\n**What This Endpoint Does:**\n1. Queries blockchain-indexer service (gRPC) for pet transfer history\n2. If indexer unavailable, falls back to direct blockchain RPC calls\n3. Returns chronological list of all ownership transfers\n4. Includes transaction hashes, block numbers, and timestamps\n5. Shows current controller (current owner) and total transfer count\n\n**Use Cases:**\n- Pet adoption history: View complete adoption timeline\n- Ownership verification: Verify current owner from blockchain\n- Audit trail: Track all ownership changes for dispute resolution\n- Provenance tracking: Full pet ownership lineage\n\n**Data Sources:**\n\n**Primary: Blockchain Indexer (Preferred):**\n- Fast indexed database queries (PostgreSQL/MySQL)\n- Supports large history (100+ transfers)\n- Includes human-readable timestamps\n- Response time: <100ms\n\n**Fallback: Direct Blockchain RPC:**\n- Used when indexer is offline or unreachable\n- Queries blockchain event logs directly\n- **Limited by RPC range limits** (typically 10,000 blocks)\n- Response time: 1-5 seconds\n- May fail for very old pets with RPC range exceeded\n\n**Fallback-Limited Mode:**\nIf both indexer and full blockchain query fail due to RPC limits:\n- Returns only current controller (from PetDIDRegistry state)\n- Returns pet creation date\n- History array is empty\n- Warning message included\n\n**Request Parameters:**\n- `:petDID`: Pet DID identifier (e.g., \"did:ethr:besu:0xabcdef...\")\n\n**Response - Successful Query (Indexer):**\n```javascript\n{\n  success: true,\n  petDID: \"did:ethr:besu:0xabcdef...\",\n  currentController: \"0x1234567890123456789012345678901234567890\",\n  totalTransfers: 3,\n  history: [\n    {\n      previousController: \"0x0000000000000000000000000000000000000000\",  // Initial registration\n      newController: \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\",   // First owner\n      blockNumber: 10000,\n      transactionHash: \"0xabc...\",\n      timestamp: 1698172800,  // Unix timestamp\n      timestampISO: \"2024-10-25T12:00:00.000Z\",\n      transferIndex: 0\n    },\n    {\n      previousController: \"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0\",\n      newController: \"0x1234567890123456789012345678901234567890\",   // Transferred to new owner\n      blockNumber: 12345,\n      transactionHash: \"0xdef...\",\n      timestamp: 1698259200,\n      timestampISO: \"2024-10-26T12:00:00.000Z\",\n      transferIndex: 1\n    },\n    {\n      previousController: \"0x1234567890123456789012345678901234567890\",\n      newController: \"0xabcdefabcdefabcdefabcdefabcdefabcdefabcd\",   // Latest transfer\n      blockNumber: 15000,\n      transactionHash: \"0xghi...\",\n      timestamp: 1698345600,\n      timestampISO: \"2024-10-27T12:00:00.000Z\",\n      transferIndex: 2\n    }\n  ],\n  source: \"blockchain-indexer\"  // or \"blockchain-fallback\" or \"blockchain-fallback-limited\"\n}\n```\n\n**Response - Blockchain Fallback (RPC Limited):**\n```javascript\n{\n  success: true,\n  petDID: \"did:ethr:besu:0xabcdef...\",\n  currentController: \"0x1234567890123456789012345678901234567890\",\n  totalTransfers: null,  // Unknown\n  history: [],  // Empty due to RPC range limit\n  warning: \"Full history unavailable - indexer offline and RPC range limit exceeded\",\n  message: \"Only current controller is available.\",\n  createdDate: \"2024-10-25T12:00:00.000Z\",  // Pet registration date\n  source: \"blockchain-fallback-limited\"\n}\n```\n\n**Response - Error:**\n```javascript\n{\n  success: false,\n  error: \"Failed to fetch pet history\",\n  message: \"Pet DID not found on blockchain\"\n}\n```\n\n**Blockchain Event Structure:**\n\n**PetDIDRegistry Contract Event:**\n```solidity\nevent ControllerChanged(\n  string indexed did,\n  address indexed previousController,\n  address indexed newController\n);\n```\n\n**Initial Registration:**\n- previousController: 0x0000000000000000000000000000000000000000 (zero address)\n- newController: First guardian address\n- Triggered by: registerPetDID() function\n\n**Ownership Transfer:**\n- previousController: Current owner address\n- newController: New owner address\n- Triggered by: changeController() function\n\n**History Interpretation:**\n\n**Transfer Index 0 (Initial Registration):**\n```javascript\n{\n  previousController: \"0x0000000000000000000000000000000000000000\",\n  newController: \"0xe9eb...\",  // First owner\n  transferIndex: 0\n}\n// Interpretation: Pet was registered by guardian 0xe9eb...\n```\n\n**Transfer Index 1+ (Ownership Transfers):**\n```javascript\n{\n  previousController: \"0xe9eb...\",  // Previous owner\n  newController: \"0x1234...\",  // New owner\n  transferIndex: 1\n}\n// Interpretation: Pet was transferred from 0xe9eb... to 0x1234...\n```\n\n**Current Controller Determination:**\n- If history exists: Last entry's newController\n- If history empty: Query PetDIDRegistry.getDIDDocument(petDID).controller\n\n**Query Parameters (Indexer):**\n- `petDID`: Pet DID to query\n- `limit`: 100 (maximum events to return)\n- `offset`: 0 (pagination offset)\n\n**Performance:**\n- Indexer query: ~50-100ms\n- Blockchain fallback: ~1-5 seconds (depends on history length)\n- Fallback-limited mode: ~100ms (single state query)\n\n**Fallback Behavior:**\n```\n1. Try indexer service (gRPC)\n   ↓ (if fails)\n2. Try blockchain RPC (event log query)\n   ↓ (if RPC range limit exceeded)\n3. Return limited data (current controller only + warning)\n```\n\n**Important Notes:**\n- History is immutable (blockchain data cannot be altered)\n- Indexer provides faster queries for long histories\n- Blockchain fallback ensures availability even if indexer is down\n- RPC range limits may prevent full history retrieval for very old pets\n- Current controller is always available (from blockchain state)\n- Transfer count includes initial registration (index 0)\n\n**Example Use Cases:**\n\n**1. Verify Current Owner:**\n```javascript\nconst response = await fetch(`/pet/history/${petDID}`);\nconst { currentController } = await response.json();\nconsole.log(`Current owner: ${currentController}`);\n```\n\n**2. Show Adoption Timeline:**\n```javascript\nconst response = await fetch(`/pet/history/${petDID}`);\nconst { history } = await response.json();\n\nhistory.forEach(transfer => {\n  if (transfer.transferIndex === 0) {\n    console.log(`Registered by: ${transfer.newController} at ${transfer.timestampISO}`);\n  } else {\n    console.log(`Transferred from ${transfer.previousController} to ${transfer.newController} at ${transfer.timestampISO}`);\n  }\n});\n```\n\n**3. Audit Ownership Changes:**\n```javascript\nconst response = await fetch(`/pet/history/${petDID}`);\nconst { totalTransfers, history } = await response.json();\nconsole.log(`Total ownership changes: ${totalTransfers}`);\nconsole.log(`Transaction hashes: ${history.map(h => h.transactionHash).join(', ')}`);\n```\n\n**Error Cases:**\n- Pet DID not found → 200 OK but success: false\n- Indexer offline + RPC limit → 200 OK with warning and limited data\n- Invalid petDID format → 400 Bad Request (validation)\n- Network error → 500 Internal Server Error\n    ","operationId":"PetController_getPetControllerHistory","parameters":[{"name":"petDID","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Pet transfer history retrieved successfully (check source field for data source)","content":{"application/json":{"schema":{"oneOf":[{"description":"Full history from indexer or blockchain","example":{"success":true,"petDID":"did:ethr:besu:0xabcdef1234567890abcdef1234567890abcdef12","currentController":"0x1234567890123456789012345678901234567890","totalTransfers":2,"history":[{"previousController":"0x0000000000000000000000000000000000000000","newController":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0","blockNumber":10000,"transactionHash":"0xabc123...","timestamp":1698172800,"timestampISO":"2024-10-25T12:00:00.000Z","transferIndex":0},{"previousController":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0","newController":"0x1234567890123456789012345678901234567890","blockNumber":12345,"transactionHash":"0xdef456...","timestamp":1698259200,"timestampISO":"2024-10-26T12:00:00.000Z","transferIndex":1}],"source":"blockchain-indexer"}},{"description":"Limited data when indexer offline and RPC range exceeded","example":{"success":true,"petDID":"did:ethr:besu:0xabcdef1234567890abcdef1234567890abcdef12","currentController":"0x1234567890123456789012345678901234567890","totalTransfers":null,"history":[],"warning":"Full history unavailable - indexer offline and RPC range limit exceeded","message":"Only current controller is available.","createdDate":"2024-10-25T12:00:00.000Z","source":"blockchain-fallback-limited"}}]}}}}},"security":[{"access-token":[]}],"summary":"Get Pet Ownership Transfer History - Adoption Records","tags":["Pet"]}},"/nose-embedder/extract":{"post":{"operationId":"NoseEmbedderController_extractNoseVector","parameters":[],"responses":{"201":{"description":""}},"security":[{"bearer":[]}],"tags":["Nose-Embedder"]}},"/nose-embedder/health":{"get":{"operationId":"NoseEmbedderController_healthCheck","parameters":[],"responses":{"200":{"description":""}},"security":[{"bearer":[]}],"tags":["Nose-Embedder"]}},"/nose-embedder/status":{"get":{"operationId":"NoseEmbedderController_getStatus","parameters":[],"responses":{"200":{"description":""}},"security":[{"bearer":[]}],"tags":["Nose-Embedder"]}},"/api/admin/health":{"get":{"description":"Check blockchain connectivity, admin account balance, and contract deployment status","operationId":"AdminController_healthCheck","parameters":[],"responses":{"200":{"description":"Health check completed"}},"security":[{"X-Admin-Key":[]}],"summary":"Blockchain health check","tags":["Admin"]}},"/api/admin/stats":{"get":{"description":"Get total pets, total guardians, and latest block info","operationId":"AdminController_getStats","parameters":[],"responses":{"200":{"description":"Statistics retrieved successfully"}},"security":[{"X-Admin-Key":[]}],"summary":"Get blockchain statistics","tags":["Admin"]}},"/api/admin/guardian/{address}":{"get":{"description":"Get full guardian profile including pets and verification status","operationId":"AdminController_getGuardianProfile","parameters":[{"name":"address","required":true,"in":"path","description":"Guardian wallet address","schema":{"example":"0x1234567890abcdef1234567890abcdef12345678","type":"string"}}],"responses":{"200":{"description":"Guardian profile retrieved"}},"security":[{"X-Admin-Key":[]}],"summary":"Get guardian profile by address","tags":["Admin"]}},"/api/admin/pet/{petDID}":{"get":{"description":"Get complete pet information including DID document, biometric data, and history","operationId":"AdminController_getPetInfo","parameters":[{"name":"petDID","required":true,"in":"path","description":"Pet DID","schema":{"example":"did:ethr:besu:0xabc...","type":"string"}}],"responses":{"200":{"description":"Pet info retrieved"}},"security":[{"X-Admin-Key":[]}],"summary":"Get pet DID document and info","tags":["Admin"]}},"/api/admin/pets/controller/{address}":{"get":{"description":"Get list of all pet DIDs controlled by a specific address","operationId":"AdminController_getPetsByController","parameters":[{"name":"address","required":true,"in":"path","description":"Controller wallet address","schema":{"example":"0x1234567890abcdef1234567890abcdef12345678","type":"string"}}],"responses":{"200":{"description":"Pets retrieved"}},"security":[{"X-Admin-Key":[]}],"summary":"Get all pets by controller address","tags":["Admin"]}},"/api/admin/check-auth":{"get":{"description":"Verify if a guardian address is authorized to manage a pet","operationId":"AdminController_checkAuthorization","parameters":[{"name":"petDID","required":true,"in":"query","description":"Pet DID to check","schema":{"example":"did:ethr:besu:0xabc...","type":"string"}},{"name":"guardianAddress","required":true,"in":"query","description":"Guardian wallet address","schema":{"example":"0x1234567890abcdef1234567890abcdef12345678","type":"string"}}],"responses":{"200":{"description":"Authorization checked"}},"security":[{"X-Admin-Key":[]}],"summary":"Check if address is authorized guardian for pet","tags":["Admin"]}},"/api/admin/tx/{txHash}":{"get":{"description":"Get detailed transaction receipt information","operationId":"AdminController_getTransactionReceipt","parameters":[{"name":"txHash","required":true,"in":"path","description":"Transaction hash","schema":{"example":"0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef","type":"string"}}],"responses":{"200":{"description":"Transaction receipt retrieved"}},"security":[{"X-Admin-Key":[]}],"summary":"Get transaction receipt by hash","tags":["Admin"]}},"/api/admin/block/{blockNumber}":{"get":{"description":"Get detailed block information","operationId":"AdminController_getBlock","parameters":[{"name":"blockNumber","required":true,"in":"path","description":"Block number","schema":{"example":"12345","type":"string"}}],"responses":{"200":{"description":"Block info retrieved"}},"security":[{"X-Admin-Key":[]}],"summary":"Get block by number","tags":["Admin"]}}},"info":{"title":"DID API Gateway","description":"DID API Gateway for VC Service and other services","version":"1.0","contact":{}},"tags":[{"name":"Admin","description":"Admin endpoints for blockchain management"},{"name":"Authentication","description":"Authentication endpoints"},{"name":"Guardian","description":"Guardian management endpoints"},{"name":"Pet","description":"Pet registration and management"},{"name":"VC","description":"Verifiable Credentials endpoints"},{"name":"Email","description":"Email verification endpoints"},{"name":"Spring Backend Proxy","description":"Spring backend proxy endpoints"},{"name":"Common","description":"Common utility endpoints"}],"servers":[],"components":{"securitySchemes":{"access-token":{"scheme":"bearer","bearerFormat":"JWT","type":"http","name":"Authorization","description":"Enter JWT token","in":"header"},"X-Admin-Key":{"type":"apiKey","in":"header","name":"X-Admin-Key","description":"Admin API Key for administrative endpoints"}},"schemas":{"ChallengeRequestDto":{"type":"object","properties":{"walletAddress":{"type":"string","description":"Wallet address (MUST be lowercase)","example":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"}},"required":["walletAddress"]},"VPSigningData":{"type":"object","properties":{"message":{"type":"object","description":"VP message object to be signed","example":{"@context":["https://www.w3.org/2018/credentials/v1"],"type":["VerifiablePresentation"],"holder":"did:ethr:besu:0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"}},"messageHash":{"type":"string","description":"Keccak256 hash of the VP message for signing","example":"0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"},"signingData":{"type":"string","description":"Full signing data string","example":"{\"@context\":[\"https://www.w3.org/2018/credentials/v1\"],...}"}},"required":["message","messageHash","signingData"]},"ChallengeResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Success status","example":true},"challenge":{"type":"string","description":"Challenge string to be signed with wallet","example":"Please sign this message to authenticate: 1234567890"},"vpSigningData":{"description":"VP signing data (null if no VCs found)","nullable":true,"allOf":[{"$ref":"#/components/schemas/VPSigningData"}]},"message":{"type":"string","description":"Instruction message","example":"Sign both challenge and VP message with your wallet"},"expiresIn":{"type":"number","description":"Challenge expiration time in seconds","example":300}},"required":["success","challenge","message","expiresIn"]},"LoginRequestDto":{"type":"object","properties":{"walletAddress":{"type":"string","description":"Wallet address (MUST be lowercase)","example":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"},"signature":{"type":"string","description":"Signature of the challenge message","example":"0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef12"},"challenge":{"type":"string","description":"Original challenge string from /api/auth/challenge","example":"Please sign this message to authenticate: 1234567890"},"vpSignature":{"type":"string","description":"VP signature (required if VCs exist)","example":"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890ab"},"vpMessage":{"type":"object","description":"VP message object from challenge response","example":{"@context":["https://www.w3.org/2018/credentials/v1"],"type":["VerifiablePresentation"],"holder":"did:ethr:besu:0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"}},"vpSignedData":{"type":"string","description":"VP signed data string","example":"{\"@context\":[\"https://www.w3.org/2018/credentials/v1\"],...}"}},"required":["walletAddress","signature","challenge"]},"GuardianInfo":{"type":"object","properties":{"guardianId":{"type":"number","description":"Guardian ID in VC service","example":123},"email":{"type":"string","description":"Guardian email address","example":"user@example.com"},"phone":{"type":"string","description":"Guardian phone number","example":"010-1234-5678","nullable":true},"name":{"type":"string","description":"Guardian full name","example":"홍길동","nullable":true},"isEmailVerified":{"type":"boolean","description":"Email verification status","example":true},"isOnChainRegistered":{"type":"boolean","description":"On-chain registration status","example":true}},"required":["guardianId","email","phone","name","isEmailVerified","isOnChainRegistered"]},"ProfileData":{"type":"object","properties":{"walletAddress":{"type":"string","description":"Wallet address","example":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"},"guardianInfo":{"description":"Guardian information (null if not registered)","nullable":true,"allOf":[{"$ref":"#/components/schemas/GuardianInfo"}]},"vcCount":{"type":"number","description":"Number of Verifiable Credentials owned","example":3}},"required":["walletAddress","guardianInfo","vcCount"]},"LoginResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Login success status","example":true},"accessToken":{"type":"string","description":"JWT access token for API authentication","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."},"refreshToken":{"type":"string","description":"Refresh token to obtain new access token","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."},"vpJwt":{"type":"string","description":"Verifiable Presentation JWT (\"EMPTY\" if no VCs)","example":"eyJhbGciOiJFUzI1NksiLCJ0eXAiOiJKV1QifQ..."},"profile":{"description":"User profile data","allOf":[{"$ref":"#/components/schemas/ProfileData"}]},"message":{"type":"string","description":"Success message","example":"로그인이 성공했습니다!!"}},"required":["success","accessToken","refreshToken","vpJwt","profile","message"]},"GuardianProfileInfo":{"type":"object","properties":{"guardianId":{"type":"number","description":"Guardian ID","example":123},"email":{"type":"string","description":"Email address","example":"user@example.com"},"phone":{"type":"string","description":"Phone number","example":"010-1234-5678","nullable":true},"name":{"type":"string","description":"Full name","example":"홍길동","nullable":true},"isEmailVerified":{"type":"boolean","description":"Email verification status","example":true},"isOnChainRegistered":{"type":"boolean","description":"On-chain registration status","example":true}},"required":["guardianId","email","phone","name","isEmailVerified","isOnChainRegistered"]},"CredentialStats":{"type":"object","properties":{"total":{"type":"number","description":"Total number of VCs","example":3},"pets":{"type":"number","description":"Number of pet VCs","example":2},"identity":{"type":"number","description":"Number of identity VCs","example":1}},"required":["total","pets","identity"]},"PetInfo":{"type":"object","properties":{"petDID":{"type":"string","description":"Pet DID","example":"did:ethr:besu:0xabc123..."},"name":{"type":"string","description":"Pet name","example":"멍멍이"},"species":{"type":"string","description":"Pet species","example":"dog"},"issuedAt":{"type":"string","description":"VC issuance date","example":"2024-01-15T10:30:00.000Z"}},"required":["petDID","name","species","issuedAt"]},"UserProfile":{"type":"object","properties":{"did":{"type":"string","description":"User DID","example":"did:ethr:besu:0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"},"walletAddress":{"type":"string","description":"Wallet address","example":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"},"isGuardian":{"type":"boolean","description":"Is registered as guardian","example":true},"guardianInfo":{"description":"Guardian information (null if not registered)","nullable":true,"allOf":[{"$ref":"#/components/schemas/GuardianProfileInfo"}]},"credentials":{"description":"Credential statistics","allOf":[{"$ref":"#/components/schemas/CredentialStats"}]},"pets":{"description":"List of owned pets","type":"array","items":{"$ref":"#/components/schemas/PetInfo"}}},"required":["did","walletAddress","isGuardian","guardianInfo","credentials","pets"]},"ProfileResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Success status","example":true},"profile":{"description":"User profile data","allOf":[{"$ref":"#/components/schemas/UserProfile"}]}},"required":["success","profile"]},"LogoutResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Success status","example":true},"message":{"type":"string","description":"Logout message","example":"Current session logged out successfully"}},"required":["success","message"]},"CreateAdoptionPostDto":{"type":"object","properties":{"petId":{"type":"number","description":"Pet ID from Spring backend database. This pet must already be registered in the Spring pet table. Get available pet IDs from GET /api/pet endpoint.","example":12345},"title":{"type":"string","description":"Adoption post title. Should be descriptive and appealing to potential adopters (e.g., \"사랑스러운 골든 리트리버 입양하세요!\").","example":"사랑스러운 골든 리트리버 입양하세요!","minLength":5,"maxLength":100},"images":{"type":"string","description":"Comma-separated list of image filenames. Upload images to S3 using POST /common first. Images should show the pet clearly from different angles.","example":"pet-photo-1.jpg,pet-photo-2.jpg,pet-photo-3.jpg"},"content":{"type":"string","description":"Detailed post content describing the pet's personality, health status, adoption requirements, and care needs. Use markdown formatting if supported.","example":"건강하고 활발한 골든 리트리버입니다. 산책을 좋아하며 아이들과도 잘 지냅니다. 예방접종 완료, 중성화 수술 완료."},"region":{"type":"string","description":"Region/Province for location filtering (e.g., \"서울\", \"경기\", \"부산\"). Used for location-based adoption post filtering.","example":"서울"},"district":{"type":"string","description":"District/City within the region (e.g., \"강남구\", \"수원시\"). Provides more specific location for potential adopters.","example":"강남구"},"shelterName":{"type":"string","description":"Shelter or organization name (required for ADMIN role guardians, optional for USER role). Displayed to show the source of the adoption post.","example":"서울 유기견 보호소"},"contact":{"type":"string","description":"Contact information for adoption inquiries (phone number, email, or Kakao ID). Shown to interested adopters.","example":"010-1234-5678 또는 kakao: petlover123"},"deadLine":{"type":"string","description":"Adoption deadline in ISO 8601 format (YYYY-MM-DD). Post will be marked as expired after this date.","example":"2025-12-31"},"status":{"type":"string","description":"Adoption post status: \"OPEN\" (accepting applications), \"PENDING\" (under review), \"CLOSED\" (completed/cancelled). Defaults to \"OPEN\".","example":"OPEN","enum":["OPEN","PENDING","CLOSED"],"default":"OPEN"}},"required":["petId","title","images","content"]},"CreateDailyStoryDto":{"type":"object","properties":{"petId":{"type":"number","description":"Pet ID from Spring backend database. This pet must be owned by the authenticated user. Get your pet IDs from GET /api/pet endpoint.","example":12345},"title":{"type":"string","description":"Daily story title. Should be engaging and describe the day's activity or moment (e.g., \"오늘 첫 산책 다녀왔어요!\", \"새로운 장난감과 놀았어요\").","example":"오늘 첫 산책 다녀왔어요!","minLength":2,"maxLength":100},"content":{"type":"string","description":"Daily story content describing your pet's daily activities, behaviors, or special moments. Share memorable experiences with the pet community.","example":"오늘 처음으로 공원에서 산책을 했습니다. 다른 강아지들과 잘 어울려 놀았고, 새로운 친구도 사귀었어요. 너무 행복해하는 모습이 귀여웠습니다!"},"images":{"type":"string","description":"Comma-separated list of image filenames showing your pet's daily moments. Upload images to S3 using POST /common first. Maximum 10 images recommended.","example":"daily-walk-1.jpg,daily-walk-2.jpg,playing-with-friends.jpg"}},"required":["petId","title","content"]},"CreateReviewStoryDto":{"type":"object","properties":{"petId":{"type":"number","description":"Pet ID from Spring backend database. This pet must be owned by the authenticated user and should have been adopted (not originally owned).","example":12345},"title":{"type":"string","description":"Adoption review title. Should describe the adoption experience (e.g., \"최고의 선택이었어요!\", \"우리 가족이 되어줘서 고마워\").","example":"최고의 선택이었어요! 행복한 입양 후기","minLength":5,"maxLength":100},"content":{"type":"string","description":"Detailed adoption review content describing the adoption process, how the pet adapted to the new home, and overall experience. Help other potential adopters by sharing your story.","example":"3개월 전 보호소에서 입양했습니다. 처음엔 낯설어했지만 지금은 완전히 적응했어요. 매일이 행복하고 입양을 결심한 것이 제 인생 최고의 선택이었습니다. 입양을 고민하시는 분들께 강력 추천합니다!"},"adoptionAgency":{"type":"string","description":"Name of the shelter, rescue organization, or individual from where the pet was adopted. This helps promote good adoption agencies and build trust.","example":"서울 유기견 보호소"},"adoptionDate":{"type":"string","description":"Date when the pet was adopted, in ISO 8601 format (YYYY-MM-DD). Used to show how long you've been together.","example":"2024-07-15"},"images":{"type":"string","description":"Comma-separated list of image filenames showing your adoption journey and life with your pet. Upload images to S3 using POST /common first. Include before/after photos if available.","example":"adoption-day-1.jpg,first-week-home.jpg,happy-together.jpg"}},"required":["petId","title","content","adoptionAgency","adoptionDate"]},"WriteCommentDto":{"type":"object","properties":{"storyId":{"type":"number","description":"Story ID to comment on. Can be either a daily story ID or adoption review story ID. Get story IDs from GET /api/story/daily/stories or GET /api/story/review/reviews endpoints.","example":789},"comment":{"type":"string","description":"Comment text content. Share your thoughts, encouragement, or questions about the story. Be respectful and supportive to the pet guardian community.","example":"정말 귀여운 강아지네요! 행복한 모습이 보기 좋습니다 :)","minLength":1,"maxLength":500}},"required":["storyId","comment"]},"CreateChatRoomDto":{"type":"object","properties":{"adoptWriterId":{"type":"string","description":"Wallet address of adoption post writer (Guardian who created the adoption post)","example":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0"},"adoptId":{"type":"number","description":"Adoption post ID to create chat room for","example":456},"roomName":{"type":"string","description":"Custom room name (optional, defaults to adoption post title)","example":"골든 리트리버 입양 문의"}},"required":["adoptWriterId","adoptId"]},"CreateDonationPostDto":{"type":"object","properties":{"memberId":{"type":"number","description":"Member ID from Spring backend database (automatically extracted from JWT token, usually not needed in request body).","example":123},"petId":{"type":"number","description":"Pet ID for which the donation is being raised. This pet should be owned by the authenticated user. Get your pet IDs from GET /api/pet endpoint.","example":12345},"title":{"type":"string","description":"Donation post title. Should clearly state the purpose and urgency (e.g., \"긴급 수술비 후원 요청\", \"치료비 지원 부탁드립니다\").","example":"긴급 수술비 후원 요청 - 다리 골절 치료","minLength":5,"maxLength":100},"targetAmount":{"type":"number","description":"Target donation amount in KRW (Korean Won). This is the total amount needed to cover the medical expenses or other costs.","example":3000000,"minimum":10000},"deadline":{"type":"string","description":"Donation deadline in ISO 8601 format (YYYY-MM-DD). After this date, the donation post may be closed or marked as expired.","example":"2025-11-30"},"category":{"type":"string","description":"Donation category: \"MEDICAL\" (medical treatment/surgery), \"FOOD\" (food support), \"SHELTER\" (shelter costs), or \"OTHER\" (other needs).","example":"MEDICAL","enum":["MEDICAL","FOOD","SHELTER","OTHER"]},"content":{"type":"string","description":"Detailed explanation of why the donation is needed. Include medical diagnosis, treatment plan, cost breakdown, and pet's current condition. Be transparent to build trust with donors.","example":"교통사고로 인해 뒷다리가 골절되었습니다. 수술비 300만원이 필요하며, 현재 병원에서 응급처치를 받은 상태입니다. 빠른 수술이 필요한 상황으로 여러분의 도움이 절실합니다."},"images":{"type":"string","description":"Comma-separated list of image filenames showing medical records, vet receipts, or pet condition. Upload images to S3 using POST /common first. Include evidence to build trust.","example":"xray-image.jpg,vet-diagnosis.jpg,pet-condition.jpg"},"bankName":{"type":"string","description":"Bank name for direct fiat currency donations (e.g., \"국민은행\", \"신한은행\"). Donors can transfer money directly to this account.","example":"국민은행"},"accountNumber":{"type":"string","description":"Bank account number for receiving donations. Ensure this is accurate to receive donor contributions.","example":"123-456-789012"},"accountHolder":{"type":"string","description":"Account holder name. Should match the authenticated user's name for verification and trust.","example":"홍길동"}},"required":["memberId","petId","title","targetAmount","deadline","category","content","bankName","accountNumber","accountHolder"]},"MakeDonationDto":{"type":"object","properties":{"memberId":{"type":"number","description":"Member ID from Spring backend database (automatically extracted from JWT token, usually not needed in request body).","example":456},"itemId":{"type":"number","description":"Bone package item ID representing the donation amount. Get available item IDs from the bone package catalog. Each item ID corresponds to a specific number of bones (e.g., itemId 1 = 10 bones, itemId 2 = 50 bones).","example":2,"minimum":1},"donationId":{"type":"number","description":"Donation post ID to which you want to donate. Get this from GET /api/donation/list endpoint.","example":789}},"required":["memberId","itemId","donationId"]},"PreparePaymentDto":{"type":"object","properties":{"itemId":{"type":"number","description":"Bone package item ID to purchase. This determines how many bones you will receive and the payment amount. Get available packages from the item catalog (e.g., itemId 1 = 1000 KRW for 10 bones, itemId 2 = 5000 KRW for 50 bones).","example":2,"minimum":1}},"required":["itemId"]},"ApprovePaymentDto":{"type":"object","properties":{"orderId":{"type":"string","description":"Order ID returned from POST /api/payment/prepare endpoint. This uniquely identifies the payment transaction.","example":"ORDER-2025-10-26-ABC123"},"paymentKey":{"type":"string","description":"Payment key received from the payment gateway (e.g., Toss Payments, Iamport) after user completes payment. This is used to verify and finalize the transaction.","example":"tviva20241026133759qLbQN"},"finalAmount":{"type":"number","description":"Final payment amount in KRW that was actually charged. Must match the amount from the prepare-payment response to prevent fraud.","example":5000,"minimum":100}},"required":["orderId","paymentKey","finalAmount"]},"PresignedUrlResponseDto":{"type":"object","properties":{"url":{"type":"string","description":"Presigned URL for direct S3 upload","example":"https://your-bucket.s3.amazonaws.com/uploads/image-uuid.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&..."},"key":{"type":"string","description":"S3 object key to use in subsequent API calls","example":"uploads/image-uuid.jpg"}},"required":["url"]},"SendVerificationCodeDto":{"type":"object","properties":{"email":{"type":"string","description":"Email address to receive verification code","example":"user@example.com"}},"required":["email"]},"SendVerificationCodeResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Indicates if the code was sent successfully","example":true},"message":{"type":"string","description":"Success message with code expiration info","example":"Verification code sent to user@example.com. Code expires in 10 minutes."},"error":{"type":"string","description":"Error message if code sending failed","example":"Rate limit exceeded. Please try again in 60 seconds."},"expiresAt":{"type":"number","description":"Code expiration timestamp (Unix timestamp in milliseconds)","example":1703001234567},"cooldownSeconds":{"type":"number","description":"Remaining time until next code can be requested (seconds)","example":60}},"required":["success"]},"VerifyEmailCodeDto":{"type":"object","properties":{"code":{"type":"string","description":"6-digit verification code received via email","example":"123456","minLength":6,"maxLength":6,"pattern":"^[0-9]{6}$"}},"required":["code"]},"VerifyEmailCodeResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Indicates if verification was successful","example":true},"message":{"type":"string","description":"Success message confirming email verification and account registration","example":"이메일 검증이 완료되었고 계정이 등록되었습니다!"},"error":{"type":"string","description":"Error message if verification failed","example":"Invalid verification code"},"warning":{"type":"string","description":"Warning message (e.g., email verified but account registration failed)","example":"이메일 검증은 성공이 성공했습니다!"},"email":{"type":"string","description":"Verified email address","example":"user@example.com"},"remainingAttempts":{"type":"number","description":"Number of verification attempts remaining (before code is invalidated)","example":2,"minimum":0,"maximum":3}},"required":["success"]},"CreateGuardianDto":{"type":"object","properties":{"email":{"type":"string","description":"Email address (required). Must be verified via POST /email/verify-code before guardian registration.","example":"user@example.com"},"role":{"type":"number","description":"User role: USER (general pet guardian) or ADMIN (shelter/organization). Determines Spring backend registration flow.","example":1,"enum":[0,1],"default":1},"phone":{"type":"string","description":"Phone number in international format (optional but recommended for account recovery)","example":"+82-10-1234-5678"},"name":{"type":"string","description":"Full name (optional). Used for user profile and pet ownership documentation.","example":"홍길동"},"nickname":{"type":"string","description":"Display nickname for community features (optional). Shown instead of real name in public areas.","example":"멋쟁이"},"profileUrl":{"type":"string","description":"Profile image filename uploaded to S3 temp folder (optional). Use POST /common to get presigned URL first. Image will be moved to permanent storage after registration.","example":"abc123-def456-ghi789.jpg"},"gender":{"type":"string","description":"Gender: \"M\" (Male) or \"F\" (Female) (optional)","example":"M","enum":["M","F"]},"old":{"type":"number","description":"Age in years (optional). Used for demographic purposes.","example":30,"minimum":1,"maximum":150},"address":{"type":"string","description":"Physical address or location (optional). Used for local pet services and adoption matching.","example":"서울시 강남구"},"walletAddress":{"type":"string","description":"Guardian wallet address (automatically extracted from JWT token, do not provide manually)","example":"0x1234567890123456789012345678901234567890"},"personalDataHash":{"type":"string","description":"Personal data hash (calculated automatically from email, phone, name, timestamp). Do not provide manually.","default":"0x0000000000000000000000000000000000000000000000000000000000000001"},"ncpStorageURI":{"type":"string","description":"NCP storage URI (not used in current implementation). Always set to \"0\".","default":"0"},"verificationMethod":{"type":"number","description":"Verification method used: 1 (SMS), 2 (Email - default), 3 (Both). Email verification is required for registration.","default":2,"enum":[1,2,3]},"signedTx":{"type":"string","description":"Signed transaction for GuardianRegistry.registerGuardian() function. Required in production mode. Sign the transaction data prepared by this endpoint or use ethers.js to sign directly.","example":"0xf86c808504a817c800825208941234567890123456789012345678901234567890880de0b6b3a76400008025a0..."}},"required":["email","role"]},"CreatePetDto":{"type":"object","properties":{"specifics":{"type":"string","description":"펫 종 (dog, cat, etc)","example":"dog","enum":["dog","cat","bird","rabbit","hamster","other"]},"images":{"type":"string","description":"Pet profile image filenames (comma-separated). Upload images to S3 first using POST /common to get presigned URLs.","example":"8a7b9c1d-2e3f-4g5h-6i7j-8k9l0m1n2o3p.jpg,9b8c0d2e-3f4g-5h6i-7j8k-9l0m1n2o3p4q.jpg"},"noseImage":{"type":"string","description":"Nose print image filename (uploaded to S3 temp folder). This will be used for biometric identification. Upload to S3 first using POST /common.","example":"7c8d9e0f-1g2h-3i4j-5k6l-7m8n9o0p1q2r.jpg"},"petName":{"type":"string","description":"반려동물 이름","example":"뽀삐"},"old":{"type":"number","description":"반려동물 나이","example":3},"gender":{"type":"number","description":"반려동물 성별","enum":[0,1],"example":0},"breed":{"type":"number","description":"반려동물 품종","enum":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],"example":14},"color":{"type":"string","description":"털 색","example":"갈색"},"weight":{"type":"number","description":"반려동물 몸무게 (kg)","example":25.5},"feature":{"type":"string","description":"특성","example":"활발함"},"neutral":{"type":"boolean","description":"중성화 여부","example":true},"biometricData":{"type":"object","description":"비문 데이터 (ML 서버에서 생성된 feature vector)","example":{"features":[0.1,0.2,0.3]}},"modelServerReference":{"type":"string","description":"ML 모델 서버 참조","example":"model-server-v1.0","default":"model-server-ref"},"sampleCount":{"type":"number","description":"비문 샘플 수","example":5,"default":1},"metadata":{"type":"object","description":"추가 메타데이터 (JSON)","example":{"vaccinations":["rabies","distemper"],"allergies":[]}},"signedTx":{"type":"string","description":"서명된 트랜잭션 (프로덕션 모드에서만 필요)","example":"0x..."},"vcSignature":{"type":"string","description":"VC 발급을 위한 서명 (보호자가 VC 발급에 동의했음을 증명)","example":"0xabcdef1234567890..."},"vcMessage":{"type":"object","description":"VC 서명에 사용된 원본 메시지 (nonce 일치를 위해 필요) - JSON string or object","example":{"vcType":"PetIdentityCredential","sub":"did:ethr:besu:0x...","guardian":"0x...","biometricHash":"0x...","petData":{},"issuedAt":"2024-01-01T00:00:00.000Z","nonce":"abc123"}},"guardianLinkSignedTx":{"type":"string","description":"Guardian Link를 위한 서명된 트랜잭션 (가디언이 Pet을 자신의 프로필에 연결)","example":"0x..."}},"required":["specifics","images","noseImage"]},"TranferImageUrlDto":{"type":"object","properties":{"image":{"type":"string","description":"Nose print image filename uploaded by new guardian for biometric verification. Must be uploaded to S3 temp folder first using POST /common. This image will be compared against the stored pet nose print.","example":"aaa-bbb-ccc-ddd-eee.jpg"}},"required":["image"]},"PetDataDto":{"type":"object","properties":{"petName":{"type":"string","description":"반려동물 이름"},"breed":{"type":"number","description":"반려동물 품종","enum":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],"example":18},"old":{"type":"number","description":"반려동물 나이","example":"3"},"weight":{"type":"number","description":"반려동물 몸무게","example":"2"},"gender":{"type":"number","description":"반려동물 성별","enum":[0,1],"example":1},"color":{"type":"string","description":"털 색","example":"갈색"},"feature":{"type":"string","description":"특성","example":"활발함"},"neutral":{"type":"boolean","description":"중성화 여부","example":true}},"required":["petName","breed","gender","color","feature","neutral"]},"AcceptTransferDto":{"type":"object","properties":{"signature":{"type":"string","description":"New guardian signature on VC transfer message. This proves new guardian consents to receiving ownership.","example":"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890ab1b"},"message":{"type":"object","description":"VC transfer message that was signed. Contains VC data with previousGuardian, newGuardian, petDID, biometricHash, and petData.","example":{"vc":{"vcType":"GuardianPetOwnershipTransferVC","credentialSubject":{"previousGuardian":"0xe9ebc691ccfb15cb4bf31af83c624b7020f0d2c0","guardian":"0x1234567890123456789012345678901234567890","petDID":"did:ethr:besu:0xabcdef...","biometricHash":"0x...","petData":{}},"issuedAt":"2025-10-25T12:00:00Z","nonce":"abc123"}}},"petData":{"description":"Pet data to include in the new VC. Should match current pet profile.","allOf":[{"$ref":"#/components/schemas/PetDataDto"}]},"verificationProof":{"type":"object","description":"Biometric verification proof from POST /pet/verify-transfer/:petDID. Proves new guardian submitted matching nose print (≥50% similarity). Valid for 10 minutes.","example":{"petDID":"did:ethr:besu:0xabcdef...","newGuardian":"0x1234567890123456789012345678901234567890","similarity":85,"verifiedAt":"2025-10-25T12:00:00.000Z","nonce":"xyz789"}},"signedTx":{"type":"string","description":"Signed transaction for PetDIDRegistry.changeController() function. Changes on-chain controller from previous guardian to new guardian. Required in production mode.","example":"0xf86c808504a817c800825208941234567890123456789012345678901234567890880de0b6b3a76400008025a0..."}},"required":["signature","message","petData","verificationProof"]}}}}